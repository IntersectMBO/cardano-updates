"use strict";(self.webpackChunkcardano_updates=self.webpackChunkcardano_updates||[]).push([[98254],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=p(n),h=a,m=c["".concat(l,".").concat(h)]||c[h]||u[h]||r;return n?o.createElement(m,i(i({ref:t},d),{},{components:n})):o.createElement(m,i({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:a,i[1]=s;for(var p=2;p<r;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},59255:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var o=n(87462),a=(n(67294),n(3905));const r={title:"Consensus Team Update",slug:"2022-12-14-consensus",authors:"dnadales",tags:["consensus"],hide_table_of_contents:!1},i=void 0,s={permalink:"/2022-12-14-consensus",editUrl:"https://github.com/intersectmbo/cardano-updates/tree/main/blog/2022-12-14-consensus.md",source:"@site/blog/2022-12-14-consensus.md",title:"Consensus Team Update",description:"High level summary",date:"2022-12-14T00:00:00.000Z",formattedDate:"December 14, 2022",tags:[{label:"consensus",permalink:"/tags/consensus"}],readingTime:2.995,hasTruncateMarker:!1,authors:[{name:"Damian Nadales",title:"Consensus Team Lead",url:"https://github.com/dnadales",imageURL:"https://github.com/dnadales.png",key:"dnadales"}],frontMatter:{title:"Consensus Team Update",slug:"2022-12-14-consensus",authors:"dnadales",tags:["consensus"],hide_table_of_contents:!1},prevItem:{title:"Mithril Team Update",permalink:"/2022-12-15-mithril"},nextItem:{title:"DB-sync Team Update",permalink:"/2022-12-14-db-sync"}},l={authorsImageUrls:[void 0]},p=[{value:"High level summary",id:"high-level-summary",level:2},{value:"Workstreams",id:"workstreams",level:2},{value:"UTxO HD prototype",id:"utxo-hd-prototype",level:3},{value:"Backing store property tests",id:"backing-store-property-tests",level:4},{value:"LSM tree implementation",id:"lsm-tree-implementation",level:3},{value:"Genesis",id:"genesis",level:3},{value:"New VRF and KES crypto integration",id:"new-vrf-and-kes-crypto-integration",level:3},{value:"Technical debt",id:"technical-debt",level:3},{value:"Fostering collaboration",id:"fostering-collaboration",level:3}],d={toc:p},c="wrapper";function u(e){let{components:t,...r}=e;return(0,a.kt)(c,(0,o.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"high-level-summary"},"High level summary"),(0,a.kt)("p",null,"During the past two weeks, the Consensus team finalized the QSM tests for the\nbacking store and Mempool on the UTxO-HD branch with important discoveries\nregarding parallel QSM testing. We also worked with the Ledger team to envisage\nthe modifications that are required in Ledger and Consensus to accommodate the\nchanges in the crypto VRF and KES. The ",(0,a.kt)("inlineCode",{parentName:"p"},"db-analyser")," now supports bechmarking\nthe ledger operations, which will allow us to identify, debug, and profile\npotential performance problems. We drafted a document that defines how to manage\nthe versions of Consensus-related packages. The top level documentation of\n",(0,a.kt)("inlineCode",{parentName:"p"},"ouroboros-network")," now features a description of the consensus components and\nprovides a hyperlinked map to the modules documentation."),(0,a.kt)("h2",{id:"workstreams"},"Workstreams"),(0,a.kt)("h3",{id:"utxo-hd-prototype"},"UTxO HD prototype"),(0,a.kt)("p",null,"Whereas we had passing sequential state-machine tests for the mempool, the\nparallel case proved to be more challenging than we thought. The operation of\nadding a list of transactions to the mempool is not atomic and, as a result,\nwhen adding a list of transactions, transactions from other processes can be\nadded in between. The mempool implementation handles this correctly, however\nthis required us to ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/input-output-hk/ouroboros-network/pull/4076"},"redesign")," the parallel model we had to take\nthe lack of atomicity into account."),(0,a.kt)("h4",{id:"backing-store-property-tests"},"Backing store property tests"),(0,a.kt)("p",null,"We finished refactoring the backing store property tests. The second review\nround is ongoing."),(0,a.kt)("h3",{id:"lsm-tree-implementation"},"LSM tree implementation"),(0,a.kt)("p",null,"We are working on benchmarking (in terms of time and number of IO operations)\nfetching/looking up data from disk."),(0,a.kt)("h3",{id:"genesis"},"Genesis"),(0,a.kt)("p",null,"We worked on the design of a mechanism to prevent a DoS attack on our Genesis\ndesign related to rollbacks. This was arguably the biggest outstanding question."),(0,a.kt)("p",null,"During the discussions around Genesis, we noticed a design boundary that nicely\ndelineates a fundamental component. We almost have a full Haskell prototype of\nit. It will be very nicely self-contained, perhaps even usable in the ultimate\nimplementation!"),(0,a.kt)("h3",{id:"new-vrf-and-kes-crypto-integration"},"New VRF and KES crypto integration"),(0,a.kt)("p",null,"We collaborated with the Ledger team on preparing the ledger state and crypto\ntypes to avoid huge allocation on the epoch boundary when changing aspects of\nthe crypto that will only manifest in headers, not in the ledger states."),(0,a.kt)("h3",{id:"technical-debt"},"Technical debt"),(0,a.kt)("p",null,"We merged the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/input-output-hk/ouroboros-network/pull/4014"},"pull-request")," that adds a support to ",(0,a.kt)("inlineCode",{parentName:"p"},"db-analyser")," for\nbenchmarking ledger operations. This will allow us to identify, debug, and\nprofile potential performance problems. The benchmark focus on the main 5 ledger\noperations that are involved in chain syncing, block forging, and block\nvalidation, namely:"),(0,a.kt)("ol",{start:0},(0,a.kt)("li",{parentName:"ol"},"Forecast."),(0,a.kt)("li",{parentName:"ol"},"Header tick."),(0,a.kt)("li",{parentName:"ol"},"Header application."),(0,a.kt)("li",{parentName:"ol"},"Block tick."),(0,a.kt)("li",{parentName:"ol"},"Block application.")),(0,a.kt)("p",null,"The following figure shows a plot of the benchmarking results for the first 65\nmillion blocks (approximately) of the Cardano chain. The thin yellow lines under\nthe x-axis show the epoch boundaries, whereas the thick yellow lines correspond\nto the era transitions."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(2666).Z,width:"1600",height:"800"})),(0,a.kt)("p",null,"As we can see in this figure, era and epoch boundaries require more computation\ntime. The ledger team are aware of this problem, and we are working to improve\nthis situation."),(0,a.kt)("h3",{id:"fostering-collaboration"},"Fostering collaboration"),(0,a.kt)("p",null,"We ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/input-output-hk/ouroboros-network/pull/4207"},"drafted a document")," motivating and defining how Consensus (and\npossibly other core teams) will/should manage our package versions. This\npull-request garnered many great discussions from our team members and other\nteams too: Sebastian Nagel, Arnaud Bailly, Michael Peyton-Jones, Ziyang Liu, et\nal. We want to thank you all for your input, and we found this discussion very\nenlightening!"),(0,a.kt)("p",null,"We merged the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/input-output-hk/ouroboros-network/pull/4197"},"pull request")," that adds an overview of consensus to\nthe ",(0,a.kt)("a",{parentName:"p",href:"https://ouroboros-network.cardano.intersectmbo.org/"},"top level\ndocumentation")," of\nouroboros-network. This overview describes the consensus components and adds a\nhyperlinked map to the modules documentation."))}u.isMDXComponent=!0},2666:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/2022-12-14-ledger-ops-benchmark-c46be3db45ff5480ed104e0d520711a6.png"}}]);