"use strict";(self.webpackChunkcardano_updates=self.webpackChunkcardano_updates||[]).push([[43539],{3905:(e,t,r)=>{r.d(t,{Zo:()=>m,kt:()=>h});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),c=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},m=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=c(r),u=a,h=d["".concat(s,".").concat(u)]||d[u]||p[u]||o;return r?n.createElement(h,i(i({ref:t},m),{},{components:r})):n.createElement(h,i({ref:t},m))}));function h(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:a,i[1]=l;for(var c=2;c<o;c++)i[c]=r[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}u.displayName="MDXCreateElement"},75175:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var n=r(87462),a=(r(67294),r(3905));const o={title:"Performance & Tracing Update",slug:"2025-05-26-performance-and-tracing",authors:"mgmeier",tags:["performance-tracing"],hide_table_of_contents:!1},i=void 0,l={permalink:"/2025-05-26-performance-and-tracing",editUrl:"https://github.com/intersectmbo/cardano-updates/tree/main/blog/2025-05-26-performance-and-tracing.md",source:"@site/blog/2025-05-26-performance-and-tracing.md",title:"Performance & Tracing Update",description:"High level summary",date:"2025-05-26T00:00:00.000Z",formattedDate:"May 26, 2025",tags:[{label:"performance-tracing",permalink:"/tags/performance-tracing"}],readingTime:3.26,hasTruncateMarker:!1,authors:[{name:"Michael Karg",title:"Performance and Tracing Team Lead",url:"https://github.com/mgmeier",imageURL:"https://github.com/mgmeier.png",key:"mgmeier"}],frontMatter:{title:"Performance & Tracing Update",slug:"2025-05-26-performance-and-tracing",authors:"mgmeier",tags:["performance-tracing"],hide_table_of_contents:!1},prevItem:{title:"Plutus Core Team Update",permalink:"/2025-05-28-plutus-core"},nextItem:{title:"SRE Team Update",permalink:"/2025-05-23-sre"}},s={authorsImageUrls:[void 0]},c=[{value:"High level summary",id:"high-level-summary",level:2},{value:"Low level overview",id:"low-level-overview",level:2},{value:"Benchmarking",id:"benchmarking",level:3},{value:"Development",id:"development",level:3},{value:"Infrastructure",id:"infrastructure",level:3},{value:"New Tracing",id:"new-tracing",level:3}],m={toc:c},d="wrapper";function p(e){let{components:t,...r}=e;return(0,a.kt)(d,(0,n.Z)({},m,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"high-level-summary"},"High level summary"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Benchmarking"),": Feature benchmarks for ledger metrics tracer and ",(0,a.kt)("inlineCode",{parentName:"li"},"InboundGovernor")," optimizations."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Development"),": Ledger metrics merged; 2 hotfixes for old tracing."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Infrastructure"),": Migration plan for on-disk benchmarks (LMDB, LSM-tree); initial Leios impact analysis."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"New Tracing"),": Tracer service now independent of Node; new feature enabling forwarding over TCP.")),(0,a.kt)("h2",{id:"low-level-overview"},"Low level overview"),(0,a.kt)("h3",{id:"benchmarking"},"Benchmarking"),(0,a.kt)("p",null,"We've completed two distinct feature benchmarks: The new periodic ledger metrics tracer and ",(0,a.kt)("inlineCode",{parentName:"p"},"InboundGovernor")," optimizations on the network layer. Both features have shown a positive performance impact; the former\nimproves CPU usage and block production metrics, the latter slightly improves diffusion metrics."),(0,a.kt)("h3",{id:"development"},"Development"),(0,a.kt)("p",null,"Having finalized and benchmarked the periodic ledger metrics tracer feature, it was merged to ",(0,a.kt)("inlineCode",{parentName:"p"},"master")," and will be part of the upcoming ",(0,a.kt)("inlineCode",{parentName:"p"},"10.5"),' release. The feature decorrelates obtaining several metrics from the beginning of the forging loop.\nThis avoids competition for synchronization primitives during the "hot phase" of block production. Furthermore, by decoupling those metrics from a forging tracer, we enable exposing those metrics from a relay as well. ',(0,a.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/cardano-node/pull/6180"},"cardano-node PR#6180")),(0,a.kt)("p",null,"Additionally, we've been vital in creating two hotfixes for the old tracing system: "),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"The old tracing system metric ",(0,a.kt)("inlineCode",{parentName:"li"},"utxoSize")," was missing due to using the pre-UTxO-HD variant of querying the set size. The fix ports the correct solution from the new tracing system to the old one: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/IntersectMBO/cardano-node/pull/6217"},"cardano-node PR#6217")),(0,a.kt)("li",{parentName:"ol"},"On the upcoming Node ",(0,a.kt)("inlineCode",{parentName:"li"},"10.5")," integration branch only, the old tracing system could leak file descriptors. Again, the fix was ported from the new tracing system to the old one - kudos to Karl Knutsson: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/input-output-hk/iohk-monitoring-framework/pull/654"},"iohk-monitoring PR#654"))),(0,a.kt)("h3",{id:"infrastructure"},"Infrastructure"),(0,a.kt)("p",null,"We've discussed and set up a migration plan for our benchmarking cluster hardware. For fair and representative performance measurements of on-disk backing stores of UTxO-HD, we require direct SSD storage on the machine instance in the cloud; running\ndisk I/O through additional layers to and from some shared SSD device, even in the same data center, would introduce significant confounding factors. The plan includes invalidating as little of our existing performance baselines as possible when\nmigrating to the new hardware. We're looking forward to benchmark the current on-disk backend (LMDB) for block producers - as well as the futuere LSM-tree based one.  "),(0,a.kt)("p",null,"We've also discussed an initial Leios impact analysis. To fairly and reliably benchmark a future Leios implementation, our infrastructure and tooling will need to be extended significantly. Several metrics won't have the same\nweight they currently carry for Praos, due to Leios' later finality; other metrics will need to be introduced for different new Leios block types, adding appropriate observability to the implementation. Finally, creating and submitting a saturation workload for a system which is built for extremely high throughput will be a challenge in itself."),(0,a.kt)("h3",{id:"new-tracing"},"New Tracing"),(0,a.kt)("p",null,"We've been working on a medium-sized refactoring that eliminates the ",(0,a.kt)("inlineCode",{parentName:"p"},"cardano-node")," dependency from ",(0,a.kt)("inlineCode",{parentName:"p"},"cardano-tracer"),". This means, the tracer service can now be built independently of the Node; all shared data types have been moved\nto some more basic packages of the new tracing system. This also enables us to issue releases of the tracer service ",(0,a.kt)("em",{parentName:"p"},"independently")," of the Node's release cycle. ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/cardano-node/pull/6125"},"cardano-node PR#6125"),"  "),(0,a.kt)("p",null,"Last not least, we've kicked off development for a new feature that's been motivated by community feedback: Forwarding observables (trace messages, metrics) over TCP. Forwarding to different hosts currently assumes a UNIX domain socket that connects the Node and\nthe tracer service through an SSH tunnel. This is a portable, versatile, and probably one of the most secure ways to transmit sensitive data. However, in an environment where an operator controls all network port mapping and firewalls, one can\nargue that forwarding over TCP/IP is equally viable, as it can be properly isolated - and it is much more convenient to set up and configure. The feature aims, when it's completed, to offer both forwarding routes, and let the end user decide."))}p.isMDXComponent=!0}}]);