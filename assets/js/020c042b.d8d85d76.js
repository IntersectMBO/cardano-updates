"use strict";(self.webpackChunkcardano_updates=self.webpackChunkcardano_updates||[]).push([[97783],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>h});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),c=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},m=function(e){var n=c(e.components);return r.createElement(s.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),p=c(t),u=a,h=p["".concat(s,".").concat(u)]||p[u]||d[u]||o;return t?r.createElement(h,i(i({ref:n},m),{},{components:t})):r.createElement(h,i({ref:n},m))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[p]="string"==typeof e?e:a,i[1]=l;for(var c=2;c<o;c++)i[c]=t[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},63449:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var r=t(87462),a=(t(67294),t(3905));const o={title:"Performance & Tracing Update",slug:"2024-08-21-performance-and-tracing",authors:"mgmeier",tags:["performance-tracing"],hide_table_of_contents:!1},i=void 0,l={permalink:"/2024-08-21-performance-and-tracing",editUrl:"https://github.com/intersectmbo/cardano-updates/tree/main/blog/2024-08-21-performance-and-tracing.md",source:"@site/blog/2024-08-21-performance-and-tracing.md",title:"Performance & Tracing Update",description:"High level summary",date:"2024-08-21T00:00:00.000Z",formattedDate:"August 21, 2024",tags:[{label:"performance-tracing",permalink:"/tags/performance-tracing"}],readingTime:3.035,hasTruncateMarker:!1,authors:[{name:"Michael Karg",title:"Performance and Tracing Team Lead",url:"https://github.com/mgmeier",imageURL:"https://github.com/mgmeier.png",key:"mgmeier"}],frontMatter:{title:"Performance & Tracing Update",slug:"2024-08-21-performance-and-tracing",authors:"mgmeier",tags:["performance-tracing"],hide_table_of_contents:!1},prevItem:{title:"Mithril Team Update",permalink:"/2024-08-21-mithril"},nextItem:{title:"Network Team Update",permalink:"/2024-08-20-network"}},s={authorsImageUrls:[void 0]},c=[{value:"High level summary",id:"high-level-summary",level:2},{value:"Low level overview",id:"low-level-overview",level:2},{value:"Benchmarking",id:"benchmarking",level:3},{value:"Development",id:"development",level:3},{value:"Workbench",id:"workbench",level:3},{value:"Infrastructure",id:"infrastructure",level:3},{value:"Tracing",id:"tracing",level:3}],m={toc:c},p="wrapper";function d(e){let{components:n,...t}=e;return(0,a.kt)(p,(0,r.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"high-level-summary"},"High level summary"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Benchmarking: Release benchmarks for Node ",(0,a.kt)("inlineCode",{parentName:"li"},"9.1"),"; UTxO-HD in-memory benchmarks; ",(0,a.kt)("inlineCode",{parentName:"li"},"typed-protocols")," feature benchmarks."),(0,a.kt)("li",{parentName:"ul"},"Development: Correct resource trace emission for CPU 85% spans metric. Governance action benchmarking still under development."),(0,a.kt)("li",{parentName:"ul"},"Workbench: Preparations for bumping ",(0,a.kt)("inlineCode",{parentName:"li"},"nixpkgs"),". Started removal of the container-based ",(0,a.kt)("inlineCode",{parentName:"li"},"podman")," backend. Support GHC9.8 ",(0,a.kt)("inlineCode",{parentName:"li"},"nix")," shells."),(0,a.kt)("li",{parentName:"ul"},"Infrastructure: Test and validate an upcoming change in ",(0,a.kt)("inlineCode",{parentName:"li"},"node-to-node")," submission protocol."),(0,a.kt)("li",{parentName:"ul"},"Tracing: ",(0,a.kt)("inlineCode",{parentName:"li"},"cardano-tracer"),": Support of non-",(0,a.kt)("inlineCode",{parentName:"li"},"systemd")," Linux was merged; safe restart of internal monitoring servers.")),(0,a.kt)("h2",{id:"low-level-overview"},"Low level overview"),(0,a.kt)("h3",{id:"benchmarking"},"Benchmarking"),(0,a.kt)("p",null,"We've run and analyzed a full set of release benchmarks for Node version ",(0,a.kt)("inlineCode",{parentName:"p"},"9.1"),". Comparing with the mainnet release ",(0,a.kt)("inlineCode",{parentName:"p"},"9.0"),", we could not observe any performance regression.  "),(0,a.kt)("p",null,"Additionally, we've performed feature benchmarks for an upcoming new API for ",(0,a.kt)("inlineCode",{parentName:"p"},"typed-protocols"),". Those did not\nexhibit any regression either in comparison with the baseline using the current API.  "),(0,a.kt)("p",null,"Furthermore, we've performed various benchmarks for the UTxO-HD in-memory backend on Node versions ",(0,a.kt)("inlineCode",{parentName:"p"},"9.0")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"9.1"),". Based\non those observations, a rare race condition could be eliminated, where block producers on occasion failed to fork off a thread for the forging loop. The overall network performance of the UTxO-HD in memory backend shows a slight improvement over the regular node, but currently comes with a slightly increased RAM usage."),(0,a.kt)("h3",{id:"development"},"Development"),(0,a.kt)("p",null,"We've spotted an inconsistency in one of our benchmarking metrics - CPU 85% spans - which measures the average number\nof consecutive slots where CPU usage spikes to 85% or higher (however short the spike itself might be). There was a difference between legacy tracing system (which yielded the correct value) and the new one, for which a fix has already been devised.  "),(0,a.kt)("p",null,"The implementation of Conway governance action workloads for benchmarking is ongoing."),(0,a.kt)("h3",{id:"workbench"},"Workbench"),(0,a.kt)("p",null,"With a ",(0,a.kt)("inlineCode",{parentName:"p"},"nixpkgs")," bump on the horizon, we're working on adjusting, and testing, our usage of packages that change their status, lose their support, or packages that require pinning a version for the workbench.  "),(0,a.kt)("p",null,"Additionally, we'll remove a container-based backend for workbench, which ties in OCI image usage on ",(0,a.kt)("inlineCode",{parentName:"p"},"podman")," with\nNomad. It was a precursor to the current Nomad backend, which is containerless and can directly build Nomad jobs using ",(0,a.kt)("inlineCode",{parentName:"p"},"nix"),".  "),(0,a.kt)("p",null,"Last not least, we've merged a small PR which enables our workbench to build ",(0,a.kt)("inlineCode",{parentName:"p"},"nix")," shells with GHC9.8, as this not only\npulls in the compiler, but much of the Haskell development toolchain. The correct version couplings between compiler and toolchain components is now declared explicitly from GHC8.10.7 up to GHC9.8."),(0,a.kt)("h3",{id:"infrastructure"},"Infrastructure"),(0,a.kt)("p",null,"We've tested and validated an upcoming change in ",(0,a.kt)("inlineCode",{parentName:"p"},"ouroboros-network")," which demands any node-to-node submission client to\nhold the connection for at least one minute before being able to submit transactions. The change works\nas expected and does not interfere with special functionality required by benchmarking."),(0,a.kt)("h3",{id:"tracing"},"Tracing"),(0,a.kt)("p",null,"The trace consumer service for the new tracing system used to require ",(0,a.kt)("inlineCode",{parentName:"p"},"systemd")," on Linux to build and operate. There are, however, Linux environments that choose to not use ",(0,a.kt)("inlineCode",{parentName:"p"},"systemd"),". It is now possible to configure the desired flavour of that service, ",(0,a.kt)("inlineCode",{parentName:"p"},"cardano-tracer"),", at build time, thus adding support for those Linuxes - ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/cardano-node/issues/5021"},"cardano-node#5021"),".  "),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"cardano-tracer")," consumes not just traces, but also metrics. With the new tracing system, this shifts running a\nmetrics server from the node to the consumer process. One possible setup in the new system is operating only one consumer service and connecting multiple nodes to it. In its current design, this requires to safely shutdown and restart the monitoring server, using the metrics store of any connected node that's been requested. We're currently\nbattle-testing ",(0,a.kt)("inlineCode",{parentName:"p"},"ekg"),"'s (the monitoring package that's being used) built-in behaviour and exploring solutions in case it does not fully meet requirements."))}d.isMDXComponent=!0}}]);