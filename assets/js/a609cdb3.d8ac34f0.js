"use strict";(self.webpackChunkcardano_updates=self.webpackChunkcardano_updates||[]).push([[32288],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>u});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},h=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(t),h=r,u=p["".concat(s,".").concat(h)]||p[h]||m[h]||i;return t?a.createElement(u,o(o({ref:n},d),{},{components:t})):a.createElement(u,o({ref:n},d))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=h;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[p]="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=t[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}h.displayName="MDXCreateElement"},60378:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=t(87462),r=(t(67294),t(3905));const i={title:"Performance & Tracing Update",slug:"2024-03-08-performance-and-tracing",authors:"mgmeier",tags:["performance-tracing"],hide_table_of_contents:!1},o=void 0,l={permalink:"/2024-03-08-performance-and-tracing",editUrl:"https://github.com/intersectmbo/cardano-updates/tree/main/blog/2024-03-08-performance-and-tracing.md",source:"@site/blog/2024-03-08-performance-and-tracing.md",title:"Performance & Tracing Update",description:"High level summary",date:"2024-03-08T00:00:00.000Z",formattedDate:"March 8, 2024",tags:[{label:"performance-tracing",permalink:"/tags/performance-tracing"}],readingTime:4.04,hasTruncateMarker:!1,authors:[{name:"Michael Karg",title:"Performance and Tracing Team Lead",url:"https://github.com/mgmeier",imageURL:"https://github.com/mgmeier.png",key:"mgmeier"}],frontMatter:{title:"Performance & Tracing Update",slug:"2024-03-08-performance-and-tracing",authors:"mgmeier",tags:["performance-tracing"],hide_table_of_contents:!1},prevItem:{title:"Hydra Team Update",permalink:"/2024-03-08-hydra"},nextItem:{title:"Consensus Team Update",permalink:"/2024-03-06-consensus"}},s={authorsImageUrls:[void 0]},c=[{value:"High level summary",id:"high-level-summary",level:2},{value:"Low level overview",id:"low-level-overview",level:2},{value:"Benchmarking",id:"benchmarking",level:3},{value:"Development",id:"development",level:3},{value:"Workbench",id:"workbench",level:3},{value:"Tracing",id:"tracing",level:3},{value:"UTxO Growth",id:"utxo-growth",level:3},{value:"Nomad cluster",id:"nomad-cluster",level:3}],d={toc:c},p="wrapper";function m(e){let{components:n,...t}=e;return(0,r.kt)(p,(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"high-level-summary"},"High level summary"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Benchmarking: We've performed release benchmarks for Node ",(0,r.kt)("inlineCode",{parentName:"li"},"8.9.0"),". Additionally, we benchmarked different GC settings for ",(0,r.kt)("inlineCode",{parentName:"li"},"cardano-node"),"."),(0,r.kt)("li",{parentName:"ul"},"Development: Ongoing work on the reporting pipeline and high-level profile definitions."),(0,r.kt)("li",{parentName:"ul"},"Workbench: In conjunction with ",(0,r.kt)("inlineCode",{parentName:"li"},"DRep")," delegations in genesis, we're working on adjustments to a new ",(0,r.kt)("inlineCode",{parentName:"li"},"cardano-cli")," command."),(0,r.kt)("li",{parentName:"ul"},"Tracing: Test coverage for the new handle registry feature in ",(0,r.kt)("inlineCode",{parentName:"li"},"cardano-tracer")," is complete."),(0,r.kt)("li",{parentName:"ul"},"UTxO Growth: Currently, we're developing a series of benchmarks targeting performance implications of increased UTxO set size."),(0,r.kt)("li",{parentName:"ul"},"Nomad cluster: Disk storage safety net; better admin access to Nomad nodes; basic backend support for more than 1 cluster; new latency service.")),(0,r.kt)("h2",{id:"low-level-overview"},"Low level overview"),(0,r.kt)("h3",{id:"benchmarking"},"Benchmarking"),(0,r.kt)("p",null,"We've performed a full set of release benchmarks for Node ",(0,r.kt)("inlineCode",{parentName:"p"},"8.9.0"),". Initially, we identified a performance regression in connection to ledger snapshots. This has been addressed very swiftly.\nHaving re-run the fixed version, we could detect no performance risks in comparison with ",(0,r.kt)("inlineCode",{parentName:"p"},"8.7.2")," / ",(0,r.kt)("inlineCode",{parentName:"p"},"8.7.3"),".  "),(0,r.kt)("p",null,"In an additional set of benchmarks, we targeted the garbage collector (GC) settings that ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-node")," is built with by default. Specifically, we compared these (copying, sequential GC) as a baseline\nto using the parallel GC, the compacting GC and the non-moving GC - all of which are supported by GHC's runtime system. As GC always is a trade-off between space and time (and as a consequence, responsiveness);\nwe could measure the parallel GC offering a slight increase in responsiveness at the cost of delaying some evaluations - which is suboptimal for a block forger. The compacting GC could clearly\nachieve a smaller RAM footprint, but only at the cost of increased CPU usage - and clearly worsened responsiveness. The non-moving GC could greatly enhance responsiveness - but increased the RAM footprint tremendously, as\nwell as introduced delays in the forging loop. In conclusion: the existing default is still the best choice by far for ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-node")," - validated both on GHC8.10.7 and GHC9.6.3."),(0,r.kt)("h3",{id:"development"},"Development"),(0,r.kt)("p",null,"The work on moving benchmark profile, and genesis, definitions out of the ",(0,r.kt)("inlineCode",{parentName:"p"},"bash")," scripting / JSON data transformation space is still ongoing. Type safety and a test suite for those tasks\nwill allow for a much more principled approach.  "),(0,r.kt)("p",null,"The implementation of additional rendering formats and report templates for our reporting pipeline has been completed; it is currently in testing and validation phase."),(0,r.kt)("h3",{id:"workbench"},"Workbench"),(0,r.kt)("p",null,"We're working on integrating new ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-cli")," functionality in our automations. Injecting ",(0,r.kt)("inlineCode",{parentName:"p"},"DRep")," delegations into genesis - for Conway ledger benchmarks - will require us\nto use a new CLI command, which differs in in output structure and options provided from the one we're using to inject stake pool delegations. This requires us to\nimplement and additional post-processing step for backends to find everything as expected."),(0,r.kt)("p",null,"Furthermore, a PR has been merged which refactors and cleans up benchmarking profiles, with a focus on fine-tuning solo-node benchmarks which scrutinize a single ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-node")," process."),(0,r.kt)("h3",{id:"tracing"},"Tracing"),(0,r.kt)("p",null,"The test suite for ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-tracer"),"'s new handle registry feature is complete, and the new feature passes all tests. At the moment, we're\npreparing it for merging into ",(0,r.kt)("inlineCode",{parentName:"p"},"master"),"."),(0,r.kt)("h3",{id:"utxo-growth"},"UTxO Growth"),(0,r.kt)("p",null,"We're developing a series of benchmarks that will provide insight into possible changes to the Node's performance characteristics given different UTxO set sizes and numbers of delegated wallets.\nWhat we aim to capture in these benchmarks is the system's capability to scale with UTxO growth - while simultaneously evaluating hardware requirements. The workloads will be based on existing release benchmarks, but allow for flexibility regarding UTxO set and delegations. They will target the existing in-memory solution, and at the same time permit feasability testing UTxO-HD's on-disk\nflavour - which does not keep the entire UTxO set in RAM permanently."),(0,r.kt)("h3",{id:"nomad-cluster"},"Nomad cluster"),(0,r.kt)("p",null,"Implementation of cluster machine disk space checking and garbage collection is complete. A requirement was that no\nmonitoring process interferes with a running benchmark, so a non-synchronous approach was chosen to guarantee enough disk space. This prevents failing\nruns, and thus the necessity to repeat them.  "),(0,r.kt)("p",null,"In the process, the workbench backend was equipped with a wider range of cluster commands and abstractions, which makes administrating cluster\nmachines more flexible. This includes a new service to create a network latency matrix for deployed cluster hardware - generalizing the approach\nchosen during the Nomad cluster's initial validation phase. This can guarantee the validity of existing baselines in case of hardware reboots, or changes\nin topology.  "),(0,r.kt)("p",null,"Last not least, the backend is currently receiving an additional feature: supporting more than 1 hardware cluster. This will enable us,\nin the future, to benchmark on ephemeral clusters - without interfering with the hard requirements, or the schedule, of release benchmarking\non our default deployment. The motivation is being able to benchmark different hardware configurations, along with varying ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-node")," options and\ninitial ledger states on a parallel schedule - also, without having to keep those clusters running at all times."))}m.isMDXComponent=!0}}]);