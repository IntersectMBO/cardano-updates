"use strict";(self.webpackChunkcardano_updates=self.webpackChunkcardano_updates||[]).push([[11626],{3905:(e,t,o)=>{o.d(t,{Zo:()=>u,kt:()=>h});var n=o(67294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var o=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(o),m=r,h=c["".concat(l,".").concat(m)]||c[m]||d[m]||a;return o?n.createElement(h,i(i({ref:t},u),{},{components:o})):n.createElement(h,i({ref:t},u))}));function h(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=o.length,i=new Array(a);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<a;p++)i[p]=o[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}m.displayName="MDXCreateElement"},62073:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var n=o(87462),r=(o(67294),o(3905));const a={title:"Network Team Update",slug:"2025-01-20-network",authors:["coot","karknu"],tags:["network"],hide_table_of_contents:!1},i=void 0,s={permalink:"/2025-01-20-network",editUrl:"https://github.com/intersectmbo/cardano-updates/tree/main/blog/2025-01-20-network.md",source:"@site/blog/2025-01-20-network.md",title:"Network Team Update",description:"Overview of sprint 78 & sprint 79",date:"2025-01-20T00:00:00.000Z",formattedDate:"January 20, 2025",tags:[{label:"network",permalink:"/tags/network"}],readingTime:3.085,hasTruncateMarker:!1,authors:[{name:"Marcin Szamotulski",title:"Network Team Lead",url:"https://github.com/coot",imageURL:"https://github.com/coot.png",key:"coot"},{name:"Karl Knutsson",title:"Software Engineer at Cardano Foundation",url:"https://github.com/karknu",imageURL:"https://github.com/karknu.png",key:"karknu"}],frontMatter:{title:"Network Team Update",slug:"2025-01-20-network",authors:["coot","karknu"],tags:["network"],hide_table_of_contents:!1},prevItem:{title:"Mithril Team Update",permalink:"/2025-01-22-mithril"},nextItem:{title:"Performance & Tracing Update",permalink:"/2025-01-17-performance-and-tracing"}},l={authorsImageUrls:[void 0,void 0]},p=[{value:"Overview of sprint 78 &amp; sprint 79",id:"overview-of-sprint-78--sprint-79",level:2},{value:"Documentation",id:"documentation",level:3},{value:"SRV Record Support",id:"srv-record-support",level:3},{value:"Quering Network State through Node-to-Client Protocol",id:"quering-network-state-through-node-to-client-protocol",level:3},{value:"Extensible Ouroboros Network Diffusion Stack",id:"extensible-ouroboros-network-diffusion-stack",level:3},{value:"Tx-Submission",id:"tx-submission",level:3},{value:"Ouroboros-Network-0.19 Release",id:"ouroboros-network-019-release",level:3},{value:"Configuration Changes for Block Propagation Times",id:"configuration-changes-for-block-propagation-times",level:3},{value:"Low-level summary",id:"low-level-summary",level:2},{value:"Querying Network State through Node-to-Client Protocol",id:"querying-network-state-through-node-to-client-protocol",level:3}],u={toc:p},c="wrapper";function d(e){let{components:t,...o}=e;return(0,r.kt)(c,(0,n.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"overview-of-sprint-78--sprint-79"},"Overview of ",(0,r.kt)("a",{parentName:"h2",href:"https://github.com/orgs/IntersectMBO/projects/5/views/1?filterQuery=sprint%3A%22Sprint+78%22"},"sprint 78")," & ",(0,r.kt)("a",{parentName:"h2",href:"https://github.com/orgs/IntersectMBO/projects/5/views/1?filterQuery=sprint%3A%22Sprint+79%22"},"sprint 79")),(0,r.kt)("h3",{id:"documentation"},"Documentation"),(0,r.kt)("p",null,"We reviewed the ",(0,r.kt)("a",{parentName:"p",href:"https://ouroboros-network.cardano.intersectmbo.org/pdfs/network-spec/network-spec.pdf"},"technical report"),". We closed a number of issues,\nthe most important are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/IntersectMBO/ouroboros-network/issues/3420"},(0,r.kt)("strong",{parentName:"a"},"Document Local Tx-Monitor mini-protocol"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/IntersectMBO/ouroboros-network/issues/4521"},(0,r.kt)("strong",{parentName:"a"},"Document CBOR encoding of Local TX-Submission mini-protocol"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/IntersectMBO/ouroboros-network/issues/2780"},(0,r.kt)("strong",{parentName:"a"},"Links to implemented mini-protocols are obsolete")))),(0,r.kt)("p",null,"And a few smaller issues:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/IntersectMBO/ouroboros-network/issues/4686"},(0,r.kt)("strong",{parentName:"a"},"RollBack claimed to sometimes contain a header"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/IntersectMBO/ouroboros-network/issues/4662"},(0,r.kt)("strong",{parentName:"a"},"Wrong colors in figure 3.7 of network-spec"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/IntersectMBO/ouroboros-network/issues/4628"},(0,r.kt)("strong",{parentName:"a"},"Is BlockFetch mini-protocol inclusive in the argument range?")),"\n(we just verified that the issue is outdated)")),(0,r.kt)("p",null,"This was done in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/ouroboros-network/pull/5036"},"Network Spec Update")," PR, we also fixed many grammar\n& spelling errors ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/ouroboros-network/pull/5044"},"network-spec: language"),"."),(0,r.kt)("h3",{id:"srv-record-support"},"SRV Record Support"),(0,r.kt)("p",null,"We worked on ",(0,r.kt)("a",{parentName:"p",href:"https://www.cloudflare.com/en-gb/learning/dns/dns-records/dns-srv-record/"},"SRV records")," support by ",(0,r.kt)("inlineCode",{parentName:"p"},"ouroboros-network"),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/ouroboros-network/issues/2780"},"issue\n#2780"),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/ouroboros-network/pull/5018"},"PR 5018"),".  We will merge it after ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/ouroboros-network/pull/5016"},"reuasble\ndiffusion"),"."),(0,r.kt)("h3",{id:"quering-network-state-through-node-to-client-protocol"},"Quering Network State through Node-to-Client Protocol"),(0,r.kt)("p",null,"The aim is to make P2P network stake available through the Local State Query\nMini-Protocol."),(0,r.kt)("p",null,"We opened a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/ouroboros-network/pull/5046"},"draft PR"),", also see the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/ouroboros-network/issues/5006"},"issue"),", where we\nmentioned all the branches where the work is progressing. See below for more\ntechnical details."),(0,r.kt)("h3",{id:"extensible-ouroboros-network-diffusion-stack"},"Extensible Ouroboros Network Diffusion Stack"),(0,r.kt)("p",null,"The work stream reached the review phase.  See ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/ouroboros-network/pull/5016"},"issue#5016"),"."),(0,r.kt)("h3",{id:"tx-submission"},"Tx-Submission"),(0,r.kt)("p",null,"The Consensus team agreed to implement needed mempool performance\noptimisations and is making progress on them. See\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/ouroboros-consensus/issues/1359"},"ouroboros-consensus#1359"),"."),(0,r.kt)("h3",{id:"ouroboros-network-019-release"},"Ouroboros-Network-0.19 Release"),(0,r.kt)("p",null,"We cut ",(0,r.kt)("inlineCode",{parentName:"p"},"ouroboros-network-0.19")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"0.19.1")," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/orgs/IntersectMBO/projects/5/views/18"},"releases"),"."),(0,r.kt)("h3",{id:"configuration-changes-for-block-propagation-times"},"Configuration Changes for Block Propagation Times"),(0,r.kt)("p",null,"Block propagation times are influenced by the number of TCP round trips\nrequired to transmit a block."),(0,r.kt)("p",null,"In mid-December, we published a ",(0,r.kt)("a",{parentName:"p",href:"https://forum.cardano.org/t/problem-with-increasing-blocksize-or-processing-requirements/140044/7"},"post")," discussing configuration\nchanges to the Linux IP stack. These adjustments involved increasing the\ninitial TCP congestion window to 42 segments and ensuring that the\ncongestion window remained open for idle connections."),(0,r.kt)("p",null,"IOG applied these changes to four stake pools located in Brazil,\nSouth Africa, Dubai, and Japan around December 15th."),(0,r.kt)("p",null,"The Cardano Foundation manages a standard peer-to-peer (P2P) node in Paris,\nwhich operates without manual connections to other Cardano\nFoundation nodes or IOG nodes. After implementing the configuration changes,\nwe noted a statistically significant improvement in the propagation times\nfor blocks larger than 10 segments (about 14,480 bytes) produced by IOG's pools."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Block Size (bytes)"),(0,r.kt)("th",{parentName:"tr",align:null},"Improvement (ms)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"14,480 - 28,960"),(0,r.kt)("td",{parentName:"tr",align:null},"-132 to -78")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"28,960 - 57,920"),(0,r.kt)("td",{parentName:"tr",align:null},"-197 to -130")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},">57,920"),(0,r.kt)("td",{parentName:"tr",align:null},"-255 to -176")))),(0,r.kt)("div",{style:{textAlign:"center"}},(0,r.kt)("img",{src:"/images/network/2025-01-20-blocks.png",alt:"Block Propagation Times",width:"600"})),(0,r.kt)("p",null,"These results demonstrate that a Stake Pool Operator (SPO) can enhance the\npropagation times of their own pool's blocks by applying config changes\ntargeting TCP's congestion window."),(0,r.kt)("h2",{id:"low-level-summary"},"Low-level summary"),(0,r.kt)("h3",{id:"querying-network-state-through-node-to-client-protocol"},"Querying Network State through Node-to-Client Protocol"),(0,r.kt)("p",null,"In the first interaction, we will make it possible to query the ",(0,r.kt)("inlineCode",{parentName:"p"},"node-to-node")," state\nthrough ",(0,r.kt)("inlineCode",{parentName:"p"},"LocalStateQuery")," mini-protocol (part of the node-to-client protocol)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-haskell"},"data ConnectionManagerState peeraddr = ConnectionManagerState {\n    connectionMap                 :: Map (ConnectionId peeraddr) AbstractState,\n    -- ^ map of connections, without outbound connections in\n    -- `ReservedOutboundSt` state.\n\n    registeredOutboundConnections :: Set peeraddr\n    -- ^ set of outbound connections in the `ReserverdOutboundSt` state.\n  }\n  deriving (Eq, Show)\n\n\ndata InboundState peeraddr = InboundState {\n    remoteHotSet  :: !(Set (ConnectionId peeraddr)),\n    remoteWarmSet :: !(Set (ConnectionId peeraddr)),\n    remoteColdSet :: !(Set (ConnectionId peeraddr)),\n    remoteIdleSet :: !(Set (ConnectionId peeraddr))\n  }\n  deriving (Eq, Show)\n\ndata OutboundState peeraddr = OutboundState {\n    coldPeers :: Set peeraddr,\n    warmPeers :: Set peeraddr,\n    hotPeers  :: Set peeraddr\n  }\n  deriving (Eq, Show)\n\n\ndata NetworkState peeraddr = NetworkState {\n    connectionManagerState :: ConnectionManagerState peeraddr,\n    inboundGovernorState   :: InboundState peeraddr,\n    outboundGovernorState  :: OutboundState peeraddr\n  }\n  deriving (Eq, Show)\n")))}d.isMDXComponent=!0}}]);