"use strict";(self.webpackChunkcardano_updates=self.webpackChunkcardano_updates||[]).push([[44822],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>u});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),h=r,u=d["".concat(s,".").concat(h)]||d[h]||m[h]||i;return n?a.createElement(u,o(o({ref:t},p),{},{components:n})):a.createElement(u,o({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},41801:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const i={title:"Performance & Tracing Update",slug:"2024-12-30-performance-and-tracing",authors:"mgmeier",tags:["performance-tracing"],hide_table_of_contents:!1},o=void 0,l={permalink:"/2024-12-30-performance-and-tracing",editUrl:"https://github.com/intersectmbo/cardano-updates/tree/main/blog/2024-12-30-performance-and-tracing.md",source:"@site/blog/2024-12-30-performance-and-tracing.md",title:"Performance & Tracing Update",description:"High level summary",date:"2024-12-30T00:00:00.000Z",formattedDate:"December 30, 2024",tags:[{label:"performance-tracing",permalink:"/tags/performance-tracing"}],readingTime:4.665,hasTruncateMarker:!1,authors:[{name:"Michael Karg",title:"Performance and Tracing Team Lead",url:"https://github.com/mgmeier",imageURL:"https://github.com/mgmeier.png",key:"mgmeier"}],frontMatter:{title:"Performance & Tracing Update",slug:"2024-12-30-performance-and-tracing",authors:"mgmeier",tags:["performance-tracing"],hide_table_of_contents:!1},prevItem:{title:"Node API & CLI Team Update",permalink:"/2025-01-01-node-cli-api"},nextItem:{title:"Network Team Update",permalink:"/2024-12-23-network"}},s={authorsImageUrls:[void 0]},c=[{value:"High level summary",id:"high-level-summary",level:2},{value:"Low level overview",id:"low-level-overview",level:2},{value:"Benchmarking",id:"benchmarking",level:3},{value:"Development",id:"development",level:3},{value:"Tracing",id:"tracing",level:3},{value:"Happy New Year!",id:"happy-new-year",level:3}],p={toc:c},d="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"high-level-summary"},"High level summary"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Benchmarking: Finalized voting benchmarks on Node ",(0,r.kt)("inlineCode",{parentName:"li"},"10.0"),"; workload implementation being generalized to be mergeable."),(0,r.kt)("li",{parentName:"ul"},"Development: Database-backend for our analysis tool ",(0,r.kt)("inlineCode",{parentName:"li"},"locli")," merged; several metrics improvements with new tracing."),(0,r.kt)("li",{parentName:"ul"},"Tracing: C library for trace forwarding started; documentation improved; timing issue in forwarder fixed.")),(0,r.kt)("h2",{id:"low-level-overview"},"Low level overview"),(0,r.kt)("h3",{id:"benchmarking"},"Benchmarking"),(0,r.kt)("p",null,"The voting benchmarks have now finished. The exact implementation of how the voting workload is set up and submitted has been finalized and is\ncurrently being prepared for merging into ",(0,r.kt)("inlineCode",{parentName:"p"},"master"),". This will add those benchmarks to the repertoire we can run on any future node version, and\ntrack potential performance changes of voting over time."),(0,r.kt)("p",null,'The setup allows us to add voting as an additional workload on top of the existing release benchmarking workloads - typically "value-only"\nand "Plutus loop". The value workload operates at 12TPS and always results in full blocks; we can draw a straight line comparison when\na certain, constant percentage of each blocks is filled with vote transactions. The Plutus workload however is throttled by spending the block execution budget,\nand not so much by transaction size and TPS - contrary to voting submissions. This results in a large variance in block size that the network produces, and\nrestricting analysis to the blocks that are actually comparable to each other greatly reduces sample size.  '),(0,r.kt)("p",null,'This means that in practice, we\'ve found "voting on top of value-only" to represent the performance implications of voting most accurately. This workload will\nserve as a base for comparison over time, and will be run selectively on new versions, whenever the proposal / voting feature of the Conway ledger is touched.  '),(0,r.kt)("p",null,"As a conclusion to those benchmarks we've ascertained that:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"there is a performance cost to voting, vote tallying and proposal enactment"),(0,r.kt)("li",{parentName:"ol"},"on the system level, this cost is very reasonable and poses no operational risk"),(0,r.kt)("li",{parentName:"ol"},"on the service level, processing an individual voting transaction is even slightly cheaper performance-wise than a transaction consuming and creating multiple UTxO entries")),(0,r.kt)("h3",{id:"development"},"Development"),(0,r.kt)("p",null,"The analysis and reporting tool, ",(0,r.kt)("inlineCode",{parentName:"p"},"locli"),' ("LogObject CLI") now comes equipped with a database-backed persistence layer. This new backend has\nbeen validated by using it to re-analyse past benchmarks. Performance workbench integration has been completed, and by means of a new envvar\nthis backend can be enabled for use in automations. It currently co-exists in ',(0,r.kt)("inlineCode",{parentName:"p"},"locli")," with the default file system based persistence backend.  "),(0,r.kt)("p",null,"Apart from opening up raw benchmarking data to the full power of SQL queries, or quickly marshalling it into another format to feed into other\napplications, the new storage backend has considerable advantages regarding execution speed and resource usage. It both requires less RAM (around 30% less)\nduring runtime, and less disk space - about 90% less! Standard analysis of a cluster run can now be performed in less than an hour, whereas it took around 2h before.  "),(0,r.kt)("p",null,"Currently, we're working on implementing parametrizable quick queries of that raw data - complete with adding plotting capabilities to ",(0,r.kt)("inlineCode",{parentName:"p"},"locli"),". The queries are\nmeant to easily extract and visualize very specific correlations that are not part of standard analysis, catering to the oftentimes investigative nature of performance analysis."),(0,r.kt)("p",null,"Furthermore, The new tracing system now provides direct insight into the chain tip's hash, exposing ",(0,r.kt)("inlineCode",{parentName:"p"},"tipBlockHash"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"tipBlockParentHash")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"tipBlockIssuerVerificationKeyHash")," both as trace\nmessages and metrics. Additionally, we've merged a fix for issue ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/cardano-node/issues/5751"},"cardano-node#5751"),": the metric ",(0,r.kt)("inlineCode",{parentName:"p"},"forging_enabled")," now correctly also observes the presence of the CLI option ",(0,r.kt)("inlineCode",{parentName:"p"},"--non-producing-node"),"."),(0,r.kt)("h3",{id:"tracing"},"Tracing"),(0,r.kt)("p",null,"The new tracing system allows for trace and metrics forwarding from some process to ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-tracer"),". For any Haskell application, the forwarder package can\neasily be included as a library. For applications written in other programming languages, we've decided a small, self-contained C library that handles forwarding is a viable\nway to provide this functionality to a much wider range of ecosystems. The C library will implement protocol handshake and possibly muxing, the forwarder protocol messages being used,\nand CBOR-based encodings of trace messages and metrics - which only exists in Haskell currently. We've just started the prototype.  "),(0,r.kt)("p",null,"We've been working hard on updating and improving the documentation for the new tracing system on ",(0,r.kt)("a",{parentName:"p",href:"https://developers.cardano.org"},"https://developers.cardano.org"),' (not merged yet). The aim was to provide a quick start guide\nto "just get it set up and running", without presupposing any knowledge of tracing, or Haskell. Moreover, for users coming from the legacy tracing system, we wanted to highlight the key\ndifferences between systems - and possibly different assumptions when operating them.   '),(0,r.kt)("p",null,"Last not least, we caught a very interesting timing issue in the forwarder: each service connected to ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-tracer")," bears both an internal and external name for the connection (both unique), where\nthe external name is chosen by the service itself. Upon forwarder initialization, so called data points are set up within the service, into which data can then be traced (such as that external name),\nand which are actively polled / queried by ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-tracer"),'. As these are all concurrent events, the external name wasn\'t yet available in the data point, if initialization of forwarding happened "too fast". Once\nlocated, fixing this was trivial by enforcing a relative ordering of concurrent events just during initialization.'),(0,r.kt)("h3",{id:"happy-new-year"},"Happy New Year!"),(0,r.kt)("p",null,"It's been an amazing year for the Performance & Tracing team. We're proud to have contributed to Cardano's transition into the age of Voltaire, and reliably safeguarded performance\nof the Cardano network - and to have finalized our new tracing system. A huge thanks to all those who've been helpful, supportive - and who've presented us with new ideas and challanges."),(0,r.kt)("p",null,"Have a Happy New Year 2025!"))}m.isMDXComponent=!0}}]);