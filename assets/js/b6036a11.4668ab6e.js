"use strict";(self.webpackChunkcardano_updates=self.webpackChunkcardano_updates||[]).push([[13753],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),h=o,m=c["".concat(s,".").concat(h)]||c[h]||d[h]||a;return n?r.createElement(m,i(i({ref:t},u),{},{components:n})):r.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:o,i[1]=l;for(var p=2;p<a;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},90109:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var r=n(87462),o=(n(67294),n(3905));const a={title:"Network Team Update",slug:"2024-01-09-network",authors:"coot",tags:["network"],hide_table_of_contents:!1},i=void 0,l={permalink:"/2024-01-09-network",editUrl:"https://github.com/intersectmbo/cardano-updates/tree/main/blog/2024-01-09-network.md",source:"@site/blog/2024-01-09-network.md",title:"Network Team Update",description:"High-level overview of sprint 52",date:"2024-01-09T00:00:00.000Z",formattedDate:"January 9, 2024",tags:[{label:"network",permalink:"/tags/network"}],readingTime:1.52,hasTruncateMarker:!1,authors:[{name:"Marcin Szamotulski",title:"Network Team Lead",url:"https://github.com/coot",imageURL:"https://github.com/coot.png",key:"coot"}],frontMatter:{title:"Network Team Update",slug:"2024-01-09-network",authors:"coot",tags:["network"],hide_table_of_contents:!1},prevItem:{title:"Mithril Team Update",permalink:"/2024-01-10-mithril"},nextItem:{title:"Hydra Team Update",permalink:"/2024-01-05-hydra"}},s={authorsImageUrls:[void 0]},p=[{value:"High-level overview of sprint 52",id:"high-level-overview-of-sprint-52",level:2},{value:"Detailed description",id:"detailed-description",level:2}],u={toc:p},c="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(c,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"high-level-overview-of-sprint-52"},"High-level overview of ",(0,o.kt)("a",{parentName:"h2",href:"https://github.com/orgs/IntersectMBO/projects/5/views/1?visibleFields=%5B%22Title%22%2C%22Labels%22%2C%22Assignees%22%2C%22Status%22%2C%22Linked+pull+requests%22%2C69151865%2C%22Repository%22%5D&filterQuery=sprint%3A%22Sprint+52%22"},"sprint 52")),(0,o.kt)("p",null,"Happy New Year!"),(0,o.kt)("p",null,"In this short sprint we analysed a failure which happened on a new large\ncluster that's run by IOG. The process exhausted all file handles and was left\nwithout any functional connections.  The issues apparently is rare, and thus\ndoesn't impose a high risk."),(0,o.kt)("p",null,"We also continued working on ",(0,o.kt)("inlineCode",{parentName:"p"},"tx-submission"),": ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/ouroboros-network/issues/3311"},"ouroboros-network-3311"),"."),(0,o.kt)("h2",{id:"detailed-description"},"Detailed description"),(0,o.kt)("p",null,"It turned out that the process exhausted the number of file handles leaking\nmultiple ",(0,o.kt)("inlineCode",{parentName:"p"},"/proc/{PID}/stat")," files open.  We suspect that the bug is caused by"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"using lazy IO in ",(0,o.kt)("inlineCode",{parentName:"li"},"iohk-monitoring-framework"),", and"),(0,o.kt)("li",{parentName:"ul"},"using a recent kernel version")),(0,o.kt)("p",null,"With lazy IO file handles are read as long as the data is required and they are\nclosed only when ",(0,o.kt)("inlineCode",{parentName:"p"},"EOF")," is reached. We currently suspect that a new linux kernel\nadded something at the end of the ",(0,o.kt)("inlineCode",{parentName:"p"},"/proc/{PID}/stat")," which is not parsed by\n",(0,o.kt)("inlineCode",{parentName:"p"},"iohk-monitoring-framework"),", so whenever the file is read we leak it (it's\nnever closed) and eventually, there are no file handles to be used by the\nnetwork layer: the ",(0,o.kt)("inlineCode",{parentName:"p"},"accept")," loop doesn't return any inbound connection, neither\nan outbound connection can be created.  This issue will be addressed by the\nprofiling team (which owns the logging subsystem)."),(0,o.kt)("p",null,"The fix will be proposed in the future release, in the meantime we suggest to\nkeep observing file handles used by the node."),(0,o.kt)("p",null,"I would like to thank John Lotoski (IOG), Karl Knutsson (CF), Neil Davies\n(PNSol) and Michael Karg (IOG) who all contributed to this analysis."),(0,o.kt)("p",null,"While analysing the log we also found a few smaller issues in the outbound\ngovernor which were fixed in ","[ouroboros-network-#4764]","."),(0,o.kt)("p",null,"The IO error indicating exhausting file handles is not currently visible.  It\nis not re-thrown nor logged.  This needs to be fixed in a future version. See\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/ouroboros-network/issues/4769"},"ouroboros-network-4769"),"."))}d.isMDXComponent=!0}}]);