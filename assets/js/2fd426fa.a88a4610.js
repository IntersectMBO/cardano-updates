"use strict";(self.webpackChunkcardano_updates=self.webpackChunkcardano_updates||[]).push([[36016],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(n),h=o,m=c["".concat(l,".").concat(h)]||c[h]||d[h]||a;return n?r.createElement(m,i(i({ref:t},p),{},{components:n})):r.createElement(m,i({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:o,i[1]=s;for(var u=2;u<a;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},89488:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var r=n(87462),o=(n(67294),n(3905));const a={title:"Consensus Team Update",slug:"2023-01-11-consensus",authors:"dnadales",tags:["consensus"],hide_table_of_contents:!1},i=void 0,s={permalink:"/2023-01-11-consensus",editUrl:"https://github.com/intersectmbo/cardano-updates/tree/main/blog/2023-01-11-consensus.md",source:"@site/blog/2023-01-11-consensus.md",title:"Consensus Team Update",description:"High level summary",date:"2023-01-11T00:00:00.000Z",formattedDate:"January 11, 2023",tags:[{label:"consensus",permalink:"/tags/consensus"}],readingTime:2.35,hasTruncateMarker:!1,authors:[{name:"Damian Nadales",title:"Consensus Team Lead",url:"https://github.com/dnadales",imageURL:"https://github.com/dnadales.png",key:"dnadales"}],frontMatter:{title:"Consensus Team Update",slug:"2023-01-11-consensus",authors:"dnadales",tags:["consensus"],hide_table_of_contents:!1},prevItem:{title:"Mithril Team Update",permalink:"/2023-01-12-mithril"},nextItem:{title:"Performance & tracing update",permalink:"/2023-01-11-performance-and-tracing"}},l={authorsImageUrls:[void 0]},u=[{value:"High level summary",id:"high-level-summary",level:2},{value:"Workstreams",id:"workstreams",level:2},{value:"UTxO HD Prototype",id:"utxo-hd-prototype",level:3},{value:"New Conway era",id:"new-conway-era",level:3},{value:"Technical debt",id:"technical-debt",level:3},{value:"Fostering collaboration",id:"fostering-collaboration",level:3}],p={toc:u},c="wrapper";function d(e){let{components:t,...a}=e;return(0,o.kt)(c,(0,r.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"high-level-summary"},"High level summary"),(0,o.kt)("p",null,"The consensus team is resuming its activities after the Christmas break. During\nthese weeks we focused on cleaning and benchmarking the UTxO-HD prototype, and\ndiscussing with the Ledger team the changes that might be required for the next\niterations. The pull request that adds the Conway era is waiting for a second\nreview round and we hope to merge it soon. On the technical debt side we are\nlooking into a property-test failure found in the iterators. We are\ninvestigating if this is an error in the model or in the implementation. We also\nimproved the documentation of our testing code."),(0,o.kt)("h2",{id:"workstreams"},"Workstreams"),(0,o.kt)("h3",{id:"utxo-hd-prototype"},"UTxO HD Prototype"),(0,o.kt)("p",null,"We worked with the Ledger team to start preparing the next versions of UTxO-HD.\nThe Ledger team is concerned that for the remaining maps we might need the full\nledger state on epoch boundaries. Since the main consumer of the ledger rules is\nConsensus, the code that requires access to a full state could be moved from the\nledger to some Ledger-Consensus bridge. Eg. the traversal of rewards could take\nplace in such bridge, instead of querying the ledger for the values that are\nrequired in the epoch-transition computations."),(0,o.kt)("p",null,"We ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/input-output-hk/ouroboros-network/pull/4234"},"relocated")," some UTxO-HD definitions, in preparation for merging\nthe prototype into ",(0,o.kt)("inlineCode",{parentName:"p"},"master"),"."),(0,o.kt)("p",null,"We also completed updated local benchmarks comparing the replay time and memory\nconsumption of:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"the baseline node (",(0,o.kt)("inlineCode",{parentName:"li"},"f2fc76ef45647275c98634da1718290b976ff364"),") "),(0,o.kt)("li",{parentName:"ul"},"the UTxO-HD node with the in-memory backend "),(0,o.kt)("li",{parentName:"ul"},"the UTxO-HD node with the LMDB backend")),(0,o.kt)("p",null,"The following plot shows the results: we can see that the LMDB node barely\nreaches 8GB of memory, but it takes 1.78 times longer to replay the chain. The\nin-memory backend is about 30 minutes faster, but still slower than the baseline\nversion. We are aware of this phenomenon and it is inherent to the problem of\nmaintaining sequences of differences of the last ",(0,o.kt)("inlineCode",{parentName:"p"},"k")," ledger states that allows\nus to perform rollback and roll-forward. We are in the process of measuring\nsyncing from scratch times."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(15253).Z,width:"2500",height:"1700"})),(0,o.kt)("p",null,"We also ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/input-output-hk/ouroboros-network/pull/4263"},"added ",(0,o.kt)("inlineCode",{parentName:"a"},"StaticEither")," accessors")," that helped us to simplify\nthe UTxO-HD prototype."),(0,o.kt)("h3",{id:"new-conway-era"},"New Conway era"),(0,o.kt)("p",null,"We incorporated the feedback of the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/input-output-hk/ouroboros-network/pull/3971"},"pull request"),", and rebased this\nbranch on top of ",(0,o.kt)("inlineCode",{parentName:"p"},"master"),". The PR is pending a second review round and we hope\nto merge this soon."),(0,o.kt)("h3",{id:"technical-debt"},"Technical debt"),(0,o.kt)("p",null,"We are investigating a ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/input-output-hk/ouroboros-network/issues/4183"},"property-testing failure")," involving\niterators. Solving this requires understanding the expected behavior of\niterators in the counterexample found by ",(0,o.kt)("inlineCode",{parentName:"p"},"QuickCheck")," to determine if the error\nis in the model or in the implementation."),(0,o.kt)("h3",{id:"fostering-collaboration"},"Fostering collaboration"),(0,o.kt)("p",null,"We ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/input-output-hk/ouroboros-network/pull/4248"},"moved")," the contents of ",(0,o.kt)("inlineCode",{parentName:"p"},"docs/Testing.md")," closer to the code, so that the\nexplanations about the tests are easier to find in the relevant modules, and the\ndocumentation is easier to keep up to date."))}d.isMDXComponent=!0},15253:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/2023-01-11-utxo-hd-replay-benchmarks-dcf6daaf5460de7591a60db1457d2e58.png"}}]);