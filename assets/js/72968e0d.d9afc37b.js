"use strict";(self.webpackChunkcardano_updates=self.webpackChunkcardano_updates||[]).push([[18069],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>h});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},m=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),p=c(t),u=r,h=p["".concat(s,".").concat(u)]||p[u]||d[u]||o;return t?a.createElement(h,i(i({ref:n},m),{},{components:t})):a.createElement(h,i({ref:n},m))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=t[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},35906:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=t(87462),r=(t(67294),t(3905));const o={title:"Performance & Tracing Update",slug:"2024-10-07-performance-and-tracing",authors:"mgmeier",tags:["performance-tracing"],hide_table_of_contents:!1},i=void 0,l={permalink:"/2024-10-07-performance-and-tracing",editUrl:"https://github.com/intersectmbo/cardano-updates/tree/main/blog/2024-10-07-performance-and-tracing.md",source:"@site/blog/2024-10-07-performance-and-tracing.md",title:"Performance & Tracing Update",description:"High level summary",date:"2024-10-07T00:00:00.000Z",formattedDate:"October 7, 2024",tags:[{label:"performance-tracing",permalink:"/tags/performance-tracing"}],readingTime:2.535,hasTruncateMarker:!1,authors:[{name:"Michael Karg",title:"Performance and Tracing Team Lead",url:"https://github.com/mgmeier",imageURL:"https://github.com/mgmeier.png",key:"mgmeier"}],frontMatter:{title:"Performance & Tracing Update",slug:"2024-10-07-performance-and-tracing",authors:"mgmeier",tags:["performance-tracing"],hide_table_of_contents:!1},prevItem:{title:"DB Sync Team Update",permalink:"/2024-10-08-db-sync"},nextItem:{title:"SRE Team Update",permalink:"/2024-10-04-sre"}},s={authorsImageUrls:[void 0]},c=[{value:"High level summary",id:"high-level-summary",level:2},{value:"Low level overview",id:"low-level-overview",level:2},{value:"Benchmarking",id:"benchmarking",level:3},{value:"Development",id:"development",level:3},{value:"Workbench",id:"workbench",level:3},{value:"Tracing",id:"tracing",level:3},{value:"Consensus QTAs",id:"consensus-qtas",level:3}],m={toc:c},p="wrapper";function d(e){let{components:n,...t}=e;return(0,r.kt)(p,(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"high-level-summary"},"High level summary"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Benchmarking: New GHC9 benchmarks for Node ",(0,r.kt)("inlineCode",{parentName:"li"},"9.2"),"."),(0,r.kt)("li",{parentName:"ul"},"Development: Progress on Governance action workload."),(0,r.kt)("li",{parentName:"ul"},"Workbench: Switch to Haskell-based profile content generation is imminent, along with significant code cleanup."),(0,r.kt)("li",{parentName:"ul"},"Tracing: New major release: ",(0,r.kt)("inlineCode",{parentName:"li"},"cardano-tracer-0.3"),"; metrics alignment is ongoing."),(0,r.kt)("li",{parentName:"ul"},"Consensus QTAs: Automation setup and implementation for ",(0,r.kt)("inlineCode",{parentName:"li"},"beacon")," is complete, entering testing.")),(0,r.kt)("h2",{id:"low-level-overview"},"Low level overview"),(0,r.kt)("h3",{id:"benchmarking"},"Benchmarking"),(0,r.kt)("p",null,"The GHC team has been busy investigating the optimization behaviour of GHC9 vs GHC8 on the Cardano code base. It appears that speculative evaluation (a feature absent from GHC8) can, in some cases, lead to overeager evaluation - and hence to\nan unnecessary performance impact on the system. We've created a build of the Node with a patched version of GHC9.6 which disables speculative evaluation for these cases only - and then we've run our release benchmark workloads on\na cluster of those nodes. The raw data is still under analysis, but initial results look promising."),(0,r.kt)("h3",{id:"development"},"Development"),(0,r.kt)("p",null,"The new governance action / voting workload for cluster-wide benchmarks is still under works. Our submission service ",(0,r.kt)("inlineCode",{parentName:"p"},"tx-generator")," is now able to assume the identity of all registered DReps to sign votes. Currently, we're working\non defining (and correctly throttling) a stream of those votes, such that a constant number of open proposals keep receiving votes throughout the entire benchmarking run."),(0,r.kt)("h3",{id:"workbench"},"Workbench"),(0,r.kt)("p",null,"The Haskell service to create benchmarking profile content, ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-profile"),", has been in beta use for some time now. It has proven to be much more maintainable, and its approach to declare profile content is much more principled than the\nexisting implementation with ",(0,r.kt)("inlineCode",{parentName:"p"},"jq")," / ",(0,r.kt)("inlineCode",{parentName:"p"},"bash"),". We've decided to switch to that service for good, including a final validation of all possible profiles between implementations. In the same go, we'll take the opportunity to remove some\nbulky parts of ",(0,r.kt)("inlineCode",{parentName:"p"},"workbench")," which were motivated by the ",(0,r.kt)("inlineCode",{parentName:"p"},"jq")," implementation, as well as simplify the corresponding nix evaluations (and redundant shell invocations)."),(0,r.kt)("h3",{id:"tracing"},"Tracing"),(0,r.kt)("p",null,"Further adjustments to the metrics naming schema in the new tracing system is ongoing.    "),(0,r.kt)("p",null,"For ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-tracer"),", several PRs have successfully landed. EKG monitoring is now capable of serving many metrics stores from just one process. Prometheus exposition has been made OpenMetrics compliant. The space leaks in the forwarding\nbackend have been verifiably closed, and the log rotation issue has been resolved. Thus, ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-tracer")," will see (alongside the next Node release) a new major release ",(0,r.kt)("inlineCode",{parentName:"p"},"0.3"),". This release is considered to be 100% production-ready."),(0,r.kt)("h3",{id:"consensus-qtas"},"Consensus QTAs"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"beacon")," - a first step in building a benchmarking framework based on Delta-Q system design - has received a fully functional automation. According to the design we settled on 3 months ago, it's now possible to test, manage, and deploy\na nix service for a self-hosted GitHub runner which performs ",(0,r.kt)("inlineCode",{parentName:"p"},"beacon")," benchmarks on pre-defined workload fragments. The runner can be triggered automatically or manually. As the nix service will likely share a host with other, potentially\nresource intensive tasks, a locking mechanism is implemented to prevent distortion of the measurements. The automation is now entering testing phase."))}d.isMDXComponent=!0}}]);