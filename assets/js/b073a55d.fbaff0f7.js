"use strict";(self.webpackChunkcardano_updates=self.webpackChunkcardano_updates||[]).push([[20955],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>h});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},m=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=c(t),d=r,h=u["".concat(s,".").concat(d)]||u[d]||p[d]||i;return t?a.createElement(h,o(o({ref:n},m),{},{components:t})):a.createElement(h,o({ref:n},m))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=d;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[u]="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=t[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},7729:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=t(87462),r=(t(67294),t(3905));const i={title:"Performance & Tracing Q3 2023 Update",slug:"2023-Q3-performance-and-tracing",authors:"mgmeier",tags:["performance-tracing"],hide_table_of_contents:!1},o=void 0,l={permalink:"/quarterly/2023-Q3-performance-and-tracing",editUrl:"https://github.com/intersectmbo/cardano-updates/tree/main/quarterly/2023-Q3-performance-and-tracing.md",source:"@site/quarterly/2023-Q3-performance-and-tracing.md",title:"Performance & Tracing Q3 2023 Update",description:"2023-07 - 2023-09",date:"2023-10-20T19:16:59.000Z",formattedDate:"October 20, 2023",tags:[{label:"performance-tracing",permalink:"/quarterly/tags/performance-tracing"}],readingTime:3.27,hasTruncateMarker:!1,authors:[{name:"Michael Karg",title:"Performance and Tracing Team Lead",url:"https://github.com/mgmeier",imageURL:"https://github.com/mgmeier.png",key:"mgmeier"}],frontMatter:{title:"Performance & Tracing Q3 2023 Update",slug:"2023-Q3-performance-and-tracing",authors:"mgmeier",tags:["performance-tracing"],hide_table_of_contents:!1},prevItem:{title:"SRE Q4 2023 Update",permalink:"/quarterly/2023-Q4-sre"},nextItem:{title:"SRE Q3 2023 Update",permalink:"/quarterly/2023-Q3-sre"}},s={authorsImageUrls:[void 0]},c=[{value:"2023-07 - 2023-09",id:"2023-07---2023-09",level:2},{value:"Main achievements",id:"main-achievements",level:3},{value:"Release benchmarking",id:"release-benchmarking",level:4},{value:"UTxO-HD benchmarks",id:"utxo-hd-benchmarks",level:4},{value:"P2P benchmarks",id:"p2p-benchmarks",level:4},{value:"New nomad cluster",id:"new-nomad-cluster",level:4},{value:"New tracing system",id:"new-tracing-system",level:4},{value:"GHC9 performance",id:"ghc9-performance",level:4},{value:"Consensus QTAs",id:"consensus-qtas",level:4},{value:"Next steps",id:"next-steps",level:3},{value:"Benchmarking:",id:"benchmarking",level:4},{value:"Performance",id:"performance",level:4},{value:"New tracing system",id:"new-tracing-system-1",level:4},{value:"UTxO-HD monitoring",id:"utxo-hd-monitoring",level:4},{value:"Nomad backend",id:"nomad-backend",level:4},{value:"Workbench",id:"workbench",level:4},{value:"Consensus component QTAs (co-development)",id:"consensus-component-qtas-co-development",level:4}],m={toc:c},u="wrapper";function p(e){let{components:n,...t}=e;return(0,r.kt)(u,(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"2023-07---2023-09"},"2023-07 - 2023-09"),(0,r.kt)("h3",{id:"main-achievements"},"Main achievements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Release benchmarking"),(0,r.kt)("li",{parentName:"ul"},"Developing and running UTxO-HD benchmarks - in-memory flavour"),(0,r.kt)("li",{parentName:"ul"},"P2P benchmarks, facilitating rollout"),(0,r.kt)("li",{parentName:"ul"},"Production-readiness of the new Nomad cluster has been reached"),(0,r.kt)("li",{parentName:"ul"},"Optimization of and introspection capability for the new tracing system"),(0,r.kt)("li",{parentName:"ul"},"GHC9 performance investigation (and possible remedy)"),(0,r.kt)("li",{parentName:"ul"},"Conensus QTAs: first real-world application of prototype")),(0,r.kt)("h4",{id:"release-benchmarking"},"Release benchmarking"),(0,r.kt)("p",null,"Ongoing release benchmarking is a crucial safeguard to ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-node"),"'s release cycle from a performance perspective. We've performed and analyzed benchmarks for node versions ",(0,r.kt)("inlineCode",{parentName:"p"},"8.2.x")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"8.5")," throughout Q3."),(0,r.kt)("h4",{id:"utxo-hd-benchmarks"},"UTxO-HD benchmarks"),(0,r.kt)("p",null,"Targeting a specific new feature in benchmarks requires development effort and fine-tuning the machinery. In Q3, we achieved that for the in-memory flavour of UTxO-HD, enabling benchmark delivery."),(0,r.kt)("h4",{id:"p2p-benchmarks"},"P2P benchmarks"),(0,r.kt)("p",null,"In Q3, we performed additional P2P benchmarks to facilitate the comprehensive rollout of that feature."),(0,r.kt)("h4",{id:"new-nomad-cluster"},"New nomad cluster"),(0,r.kt)("p",null,"The new hardware cluster for benchmarks, which is controlled through the new nomad backend, has received\nvarious rounds of validation and adjustments in Q3 - in addition to finalizing integration with the rest\nof our pipeline. The confidence in metrics gathered on the cluster is now sufficient for us to consider it\nready for production use."),(0,r.kt)("h4",{id:"new-tracing-system"},"New tracing system"),(0,r.kt)("p",null,"Our new tracing system has received various rounds of optimization in Q3. We could verify in our benchmarks that\nit is roughly on par with the legacy system while offering a richer feature set and greater flexibility.  "),(0,r.kt)("p",null,"Additionally, in Q3 we equipped the system with an introspection capability. This is now used for generating\nend user documentation that stays in-sync with definitions in code, and for automated consistency checking of the entire system."),(0,r.kt)("h4",{id:"ghc9-performance"},"GHC9 performance"),(0,r.kt)("p",null,"In Q3, a joint investigation with DevX into GHC9's behaviour revealed where and how GHC9 misses opportunities for\noptimization of generated code. This led to an approach to annotate our codebase accordingly to re-enable\nthose optimizations - which is still being validated."),(0,r.kt)("h4",{id:"consensus-qtas"},"Consensus QTAs"),(0,r.kt)("p",null,"In collaboration with Consensus and DevX, we advanced the Consensus QTAs prototype capturing ledger operations'\nperformance characteristics. It's now applicable, and being applied, to a real-world task - namely\ngathering evidence of the effect of aforementioned changes allowing for performant GHC9 builds."),(0,r.kt)("h3",{id:"next-steps"},"Next steps"),(0,r.kt)("h4",{id:"benchmarking"},"Benchmarking:"),(0,r.kt)("p",null,"In Q4, the focus will be on:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"facilitating the next mainnet release"),(0,r.kt)("li",{parentName:"ul"},"benchmarking runs in the Conway era"),(0,r.kt)("li",{parentName:"ul"},"developing benchmarks / workloads for Conway-exclusive actions"),(0,r.kt)("li",{parentName:"ul"},"implementing a specialized benchmark setup for the UTxO-HD on-disk variant"),(0,r.kt)("li",{parentName:"ul"},"developing new Plutus benchmarks to safeguard Plutus V3"),(0,r.kt)("li",{parentName:"ul"},"benchmarks regarding the rollout of P2P")),(0,r.kt)("h4",{id:"performance"},"Performance"),(0,r.kt)("p",null,"For certain blocking performance issues we've located the cause, or even found a solution in a cross-team effort. In Q4 we'll advance that work to ensure the ongoing\nrelease cycle for mainnet, as well as make GHC9 become a viable release platform."),(0,r.kt)("h4",{id:"new-tracing-system-1"},"New tracing system"),(0,r.kt)("p",null,"For the new tracing system, we'll finalize optimization - current results are already on par with the legacy system. Furthermore, we will finish up comprehensive documentation, as well as description of a recommended setup, for which we can provide initial support."),(0,r.kt)("h4",{id:"utxo-hd-monitoring"},"UTxO-HD monitoring"),(0,r.kt)("p",null,"We'll augment our analysis pipeline so it can process monitoring data from UTxO-HD nodes connected to mainnet in a meaningful way."),(0,r.kt)("h4",{id:"nomad-backend"},"Nomad backend"),(0,r.kt)("p",null,"From Q4 on, this backend will be in production use. We plan on adding various UX and flexibility improvements, and further fine-tuning some profiles for nomad."),(0,r.kt)("h4",{id:"workbench"},"Workbench"),(0,r.kt)("p",null,"We will prepare for a future move of our performance workbench into a separate project. This entails restructuring, refactoring and reimplementation of certain few components that currently assume to always be in sync with ",(0,r.kt)("inlineCode",{parentName:"p"},"cardano-node"),"."),(0,r.kt)("h4",{id:"consensus-component-qtas-co-development"},"Consensus component QTAs (co-development)"),(0,r.kt)("p",null,"In Q4 there will be ongoing work with and support for the existing prototype. We plan to identify a fixed set of input data that yields results of high informative value, and to formalize the process to a point that enables future automation."))}p.isMDXComponent=!0}}]);