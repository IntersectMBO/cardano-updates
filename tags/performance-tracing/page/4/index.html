<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-updates">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">54 posts tagged with &quot;performance-tracing&quot; | Cardano Development Updates</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://updates.cardano.intersectmbo.org/tags/performance-tracing/page/4"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="54 posts tagged with &quot;performance-tracing&quot; | Cardano Development Updates"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://updates.cardano.intersectmbo.org/tags/performance-tracing/page/4"><link data-rh="true" rel="alternate" href="https://updates.cardano.intersectmbo.org/tags/performance-tracing/page/4" hreflang="en"><link data-rh="true" rel="alternate" href="https://updates.cardano.intersectmbo.org/tags/performance-tracing/page/4" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Cardano Updates Feed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Cardano Updates Feed Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="Cardano Updates Feed JSON Feed">



<link rel="alternate" type="application/rss+xml" href="/quarterly/rss.xml" title="Cardano Development Updates RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/quarterly/atom.xml" title="Cardano Development Updates Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/reports/rss.xml" title="Cardano Development Updates RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/reports/atom.xml" title="Cardano Development Updates Atom Feed">

<script src="https://plausible.io/js/script.js" defer="defer" data-domain="updates.cardano.intersectmbo.org"></script><link rel="stylesheet" href="/assets/css/styles.5c10ca85.css">
<link rel="preload" href="/assets/js/runtime~main.a4621276.js" as="script">
<link rel="preload" href="/assets/js/main.40817c1a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Cardano Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Cardano Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Cardano Updates</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Home</a><a class="navbar__item navbar__link" href="/quarterly">Quarterly</a><a class="navbar__item navbar__link" href="/reports">Reports</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/tags">Topics</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/tags">All Topics</a></li><li><a class="dropdown__link" href="/tags/network">Network</a></li><li><a class="dropdown__link" href="/tags/consensus">Consensus</a></li><li><a class="dropdown__link" href="/tags/ledger">Ledger</a></li><li><a class="dropdown__link" href="/tags/hydra">Hydra</a></li><li><a class="dropdown__link" href="/tags/db-sync">DB Sync</a></li><li><a class="dropdown__link" href="/tags/cli-api">Node CLI &amp; API</a></li><li><a class="dropdown__link" href="/quarterly/tags/cli-api-quarterly">Node CLI &amp; API Quarterly</a></li><li><a class="dropdown__link" href="/tags/crypto">Crypto</a></li><li><a class="dropdown__link" href="/tags/goedel">Goedel</a></li><li><a class="dropdown__link" href="/tags/mithril">Mithril</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/tags/performance-tracing">Performance &amp; Tracing</a></li><li><a class="dropdown__link" href="/reports/tags/benchmarking-reports">Benchmarking Reports</a></li><li><a class="dropdown__link" href="/tags/incident">Incident Reports</a></li><li><a class="dropdown__link" href="/tags/security">Security Reports</a></li></ul></div><a class="navbar__item navbar__link" href="/archive">Archive</a><a href="https://updates.cardano.intersectmbo.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent Posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2025-10-29-consensus">Consensus Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2025-10-29-ledger">Ledger Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2025-10-29-mithril">Mithril Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2025-10-27-performance-and-tracing">Performance &amp; Tracing Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2025-10-24-network">Network Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2025-10-22-mithril">Mithril Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2025-10-17-hydra">Hydra Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2025-10-15-mithril">Mithril Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2025-10-14-consensus">Consensus Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2025-10-10-sre">SRE Team Update</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>54 posts tagged with &quot;performance-tracing&quot;</h1><a href="/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2024-10-07-performance-and-tracing">Performance &amp; Tracing Update</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-10-07T00:00:00.000Z" itemprop="datePublished">October 7, 2024</time> Â· <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/mgmeier" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/mgmeier.png" alt="Michael Karg"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/mgmeier" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Michael Karg</span></a></div><small class="avatar__subtitle" itemprop="description">Performance and Tracing Team Lead</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-summary">High level summary<a class="hash-link" href="#high-level-summary" title="Direct link to heading">â</a></h2><ul><li>Benchmarking: New GHC9 benchmarks for Node <code>9.2</code>.</li><li>Development: Progress on Governance action workload.</li><li>Workbench: Switch to Haskell-based profile content generation is imminent, along with significant code cleanup.</li><li>Tracing: New major release: <code>cardano-tracer-0.3</code>; metrics alignment is ongoing.</li><li>Consensus QTAs: Automation setup and implementation for <code>beacon</code> is complete, entering testing.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="low-level-overview">Low level overview<a class="hash-link" href="#low-level-overview" title="Direct link to heading">â</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking">Benchmarking<a class="hash-link" href="#benchmarking" title="Direct link to heading">â</a></h3><p>The GHC team has been busy investigating the optimization behaviour of GHC9 vs GHC8 on the Cardano code base. It appears that speculative evaluation (a feature absent from GHC8) can, in some cases, lead to overeager evaluation - and hence to
an unnecessary performance impact on the system. We&#x27;ve created a build of the Node with a patched version of GHC9.6 which disables speculative evaluation for these cases only - and then we&#x27;ve run our release benchmark workloads on
a cluster of those nodes. The raw data is still under analysis, but initial results look promising.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="development">Development<a class="hash-link" href="#development" title="Direct link to heading">â</a></h3><p>The new governance action / voting workload for cluster-wide benchmarks is still under works. Our submission service <code>tx-generator</code> is now able to assume the identity of all registered DReps to sign votes. Currently, we&#x27;re working
on defining (and correctly throttling) a stream of those votes, such that a constant number of open proposals keep receiving votes throughout the entire benchmarking run.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="workbench">Workbench<a class="hash-link" href="#workbench" title="Direct link to heading">â</a></h3><p>The Haskell service to create benchmarking profile content, <code>cardano-profile</code>, has been in beta use for some time now. It has proven to be much more maintainable, and its approach to declare profile content is much more principled than the
existing implementation with <code>jq</code> / <code>bash</code>. We&#x27;ve decided to switch to that service for good, including a final validation of all possible profiles between implementations. In the same go, we&#x27;ll take the opportunity to remove some
bulky parts of <code>workbench</code> which were motivated by the <code>jq</code> implementation, as well as simplify the corresponding nix evaluations (and redundant shell invocations).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tracing">Tracing<a class="hash-link" href="#tracing" title="Direct link to heading">â</a></h3><p>Further adjustments to the metrics naming schema in the new tracing system is ongoing.    </p><p>For <code>cardano-tracer</code>, several PRs have successfully landed. EKG monitoring is now capable of serving many metrics stores from just one process. Prometheus exposition has been made OpenMetrics compliant. The space leaks in the forwarding
backend have been verifiably closed, and the log rotation issue has been resolved. Thus, <code>cardano-tracer</code> will see (alongside the next Node release) a new major release <code>0.3</code>. This release is considered to be 100% production-ready.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="consensus-qtas">Consensus QTAs<a class="hash-link" href="#consensus-qtas" title="Direct link to heading">â</a></h3><p><code>beacon</code> - a first step in building a benchmarking framework based on Delta-Q system design - has received a fully functional automation. According to the design we settled on 3 months ago, it&#x27;s now possible to test, manage, and deploy
a nix service for a self-hosted GitHub runner which performs <code>beacon</code> benchmarks on pre-defined workload fragments. The runner can be triggered automatically or manually. As the nix service will likely share a host with other, potentially
resource intensive tasks, a locking mechanism is implemented to prevent distortion of the measurements. The automation is now entering testing phase.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/performance-tracing">performance-tracing</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2024-09-23-performance-and-tracing">Performance &amp; Tracing Update</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-09-23T00:00:00.000Z" itemprop="datePublished">September 23, 2024</time> Â· <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/mgmeier" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/mgmeier.png" alt="Michael Karg"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/mgmeier" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Michael Karg</span></a></div><small class="avatar__subtitle" itemprop="description">Performance and Tracing Team Lead</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-summary">High level summary<a class="hash-link" href="#high-level-summary" title="Direct link to heading">â</a></h2><ul><li>Benchmarking: Release benchmarks for Node <code>9.2.0</code>. Validating the new &quot;age of Voltaire&quot; performance baseline.</li><li>Development - New Tracing System: A space leak in the forwarding mechanism was fixed; a log rotation bug is being investigated.</li><li>Workbench: Large refactoring of <code>workbench</code>, optimizing nix closure size and adding profile flake outputs. Adjusted Nomad backend was merged.</li><li>Infrastructure: Dropping <code>Vault</code> for the Nomad cluster was tested and merged.</li><li>Tracing: Further metrics names alignment; be OpenMetrics specs compliant; adding annotations to Prometheus metrics; internal monitoring servers routing has entered testing.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="low-level-overview">Low level overview<a class="hash-link" href="#low-level-overview" title="Direct link to heading">â</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking">Benchmarking<a class="hash-link" href="#benchmarking" title="Direct link to heading">â</a></h3><p>We&#x27;ve run and analyzed a full set of release benchmarks for Node version <code>9.2.0</code>. In comparison with Mainnet release <code>9.1.1</code>, we could not observe any performance regression.  </p><p>Moreover, we&#x27;ve validated the stability of our new &quot;age of Voltaire&quot; performance baseline on <code>9.1.1</code>. Currently, we&#x27;re running a cross-comparison between baselines and Node versions <code>9.1.1</code> and <code>9.2.0</code> to ascertain that
the new baseline arrives - at scale - at the same performance observations and predictions as the previous one.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="development---new-tracing-system">Development - New Tracing System<a class="hash-link" href="#development---new-tracing-system" title="Direct link to heading">â</a></h3><p>Forwarding traces and metrics in the new system exhibited a tiny space leak. Under conventional operation, this leak would only become noticeable after running uninterrupted for days or even weeks. It took very hard pressure on the
system, and additional profiling, to make it visible. It could be fixed by avoiding unnecessary allocations of continuations: The buffer of objects to forward inherently carries the position of the next object to process, such that a fully
evaluated closure can trivially be reused to handle any subsequent forwarding request. This has led to new versions of packages <code>trace-foward-2.2.7</code> and <code>ekg-forward-0.6</code>. Huge thanks to John Lotoski and Javier Sagredo, whose
meticulous information helped to swiftly address the issue.  </p><p>On the benchmarking cluster, we&#x27;ve observed <code>cardano-tracer</code>&#x27;s log rotation to occasionally misbehave: under certain circumstances, the service leaks handles by not redirecting output to the latest log file in the rotation. We&#x27;ve located the
issue and are working towards a fix.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="workbench">Workbench<a class="hash-link" href="#workbench" title="Direct link to heading">â</a></h3><p>We&#x27;ve been working on a major refactoring of <code>workbench</code> code. The main benefit of this endeavour is being able to pull in a very heavy dependency optionally only when required, when building and running the <code>workbench</code> shell. This will especially facilitate runs on CI machines after garbage collections, but also building a local shell on individual developer machines. Additionally, benchmarking profiles designed for the cluster are now provided as nix flake outputs. This allows for building a more versatile automation in the future, where <code>workbench</code> and <code>cardano-node</code> commits won&#x27;t need to be tied to each other. Last not least, the refactoring simplified the way the shell commands are evaluated, doing away with nested calls in many instances. The refactoring PR has been thouroughly tested and merged.</p><p>Furthermore, the workbench is now prepared for a <code>nixpkgs</code> upgrade and has dropped the container-based Nomad / <code>podman</code> backend - the respective PR was merged successfully.  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="infrastructure">Infrastructure<a class="hash-link" href="#infrastructure" title="Direct link to heading">â</a></h3><p>Removal of the <code>Vault</code> service for managing benchmarking cluster credentials has been successfully tested and merged. The service is scheduled for final shutdown end of month, reducing hardware cost and maintenance effort.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tracing">Tracing<a class="hash-link" href="#tracing" title="Direct link to heading">â</a></h3><p>We&#x27;ve received initial feedback regarding the alignment of metrics names between new and legacy tracing systems. Based upon that feedback, we&#x27;re currently working on some further adjustments to the naming schema.    </p><p>The implementation for hosting multiple EKG monitors in one single service has been finished and is currently in the testing phase. The dynamic routing to monitoring data, now used both for EKG and Prometheus, reflects the nodes that are connected to <code>cardano-tracer</code>. We&#x27;ve also added a JSON response format, which makes it easier to query and scrape existing routes as part of automations. Finally, this PR also removes the dependency on the <code>snap</code> server framework and transitively on <code>HsOpenSSL</code> (which is prone to cause build issues in the future).  </p><p>Currently, we&#x27;re working on various improvements to the Prometheus metric expositions in <code>cardano-tracer</code>. We aim to implement full compliance with the OpenMetrics specification, which should greatly enhance integration processes. Furthermore, metrics
will be augmented with <code># TYPE</code> and <code># HELP</code> annotations, as tracked in issue <a href="https://github.com/IntersectMBO/cardano-node/issues/5140" target="_blank" rel="noopener noreferrer">cardano-node#5021</a>.</p><p>Last not least, we&#x27;ve closed off issue <a href="https://github.com/IntersectMBO/cardano-node/issues/3988" target="_blank" rel="noopener noreferrer">cardano-node#3988</a>. For adding an optional prefix to metrics names, the Node config option <code>TraceOptionMetricsPrefix</code> can now be used. </p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/performance-tracing">performance-tracing</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2024-09-09-performance-and-tracing">Performance &amp; Tracing Update</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-09-09T00:00:00.000Z" itemprop="datePublished">September 9, 2024</time> Â· <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/mgmeier" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/mgmeier.png" alt="Michael Karg"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/mgmeier" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Michael Karg</span></a></div><small class="avatar__subtitle" itemprop="description">Performance and Tracing Team Lead</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-summary">High level summary<a class="hash-link" href="#high-level-summary" title="Direct link to heading">â</a></h2><ul><li>Benchmarking: Release benchmarks for Node <code>9.1.1</code>; additional UTxO-HD in-memory benchmarks.</li><li>Development: Created a local reproduction for observed UTxO-HD RAM increase.</li><li>Workbench: Created a new &quot;age of Voltaire&quot; performance baseline. Adjusted Nomad backend has entered testing phase.</li><li>Infrastructure: Dropping the requirement on <code>Vault</code>, optimizing cluster setup.</li><li>Tracing: New metrics naming schema was merged. Routing to internal monitoring servers is ongoing. Dropping dependency on <code>HsOpenSSL</code>.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="low-level-overview">Low level overview<a class="hash-link" href="#low-level-overview" title="Direct link to heading">â</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking">Benchmarking<a class="hash-link" href="#benchmarking" title="Direct link to heading">â</a></h3><p>Runs and analyses for a full set of release benchmarks have been performed for Node version <code>9.1.1</code>. In comparison with Mainnet releases <code>9.0</code> and <code>9.1.0</code>, we could determine this version does not exhibit any performance regression.  </p><p>Having been provided with the patch by Consensus targeting the increased RAM usage of the UTxO-HD in-memory backend (read below), we&#x27;ve performed additional benchmarks to validate the desired result on the cluster. Our measurements demonstrate the increased
memory need has now vanished. We&#x27;re confident that by now we&#x27;ve located - and addressed - all performance risks for UTxO-HD in-memory that we can capture given the instruments at our disposal. To gain further confidence in the stability
of resource usage pattern and network metrics observed on the benchmarking cluster, we&#x27;ve advised long-running UTxO-HD nodes under close monitoring.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="development">Development<a class="hash-link" href="#development" title="Direct link to heading">â</a></h3><p>We succeeded in creating a local reproduction of the increase in RAM usage that was observed for the UTxO-HD in-memory backend on the cluster. That reproduction enabled the Consensus team to inspect in real-time and profile running Node processes - which
led to a swift identification of the underlying cause and a patch addressing it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="workbench">Workbench<a class="hash-link" href="#workbench" title="Direct link to heading">â</a></h3><p>After the smooth Chang hard fork which transitioned Cardano into the Conway era, we&#x27;ve created - and merged - a new performance baseline. It&#x27;s intended for release benchmarks and caters to the new features of the Conway ledger. Apart from incorporating the latest protocol version and Plutus cost models, it includes DRep presence in ledger when performing measurements.  </p><p>The PR preparing our workbench for a <code>nixpkgs</code> upgrade and removing the container-based Nomad / <code>podman</code> backend is complete and has entered testing phase.  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="infrastructure">Infrastructure<a class="hash-link" href="#infrastructure" title="Direct link to heading">â</a></h3><p>Currently, our Nomad cluster uses <code>Vault</code> to manage access and credentials for the benchmarking cluster. As the cluster exclusively relies on static routes, and fixed deployment endpoints, encoding access as a set of rules into the cloud infrastructure
is a viable option. That way, we will no longer depend on the <code>Vault</code> service, removing the requirement of hosting, and maintaining, an instance of it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tracing">Tracing<a class="hash-link" href="#tracing" title="Direct link to heading">â</a></h3><p>Aligning the metrics naming schema and semantics between new and legacy tracing systems has been completed and merged. This will enable a seamless interchange in the community, as all existing configurations of monitoring services remain their validity.  </p><p>As for hosting multiple EKG metrics monitors in one single service application, we ascertained that the <code>ekg</code> package was not built for that use case. However, we&#x27;ve come up with a much nicer design for <code>cardano-tracer</code> using dynamic routing based on the names of nodes
connected to it. It has successfully passed prototype stage in that it&#x27;s able to serve multiple EKG monitors without the need for any server restart; the full implementation is being worked on.  </p><p>Last not least, both existing tracing systems rely on the <code>snap</code> server framework, and thus by transitive dependency, on <code>HsOpenSSL</code> to speak the HTTPS protocol. However, we&#x27;ve determined the latter package to have a risk of breaking the build, both currently and in the future (cf. <a href="https://github.com/haskell-cryptography/HsOpenSSL/issues/95" target="_blank" rel="noopener noreferrer">HsOpenSSL#95</a> and <a href="https://github.com/haskell-cryptography/HsOpenSSL/issues/88" target="_blank" rel="noopener noreferrer">HsOpenSSL#88</a>). As a consequence, a switch to the <code>wai</code> / <code>warp</code> based framework was decided, which implements HTTPS capability differently, thus preempting the risk. This has already been carried out for the legacy system, and currently is
for <code>cardano-tracer</code> - a big shoutout to Erik de Castro Lopo for his support on that issue.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/performance-tracing">performance-tracing</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2024-08-21-performance-and-tracing">Performance &amp; Tracing Update</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-08-21T00:00:00.000Z" itemprop="datePublished">August 21, 2024</time> Â· <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/mgmeier" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/mgmeier.png" alt="Michael Karg"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/mgmeier" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Michael Karg</span></a></div><small class="avatar__subtitle" itemprop="description">Performance and Tracing Team Lead</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-summary">High level summary<a class="hash-link" href="#high-level-summary" title="Direct link to heading">â</a></h2><ul><li>Benchmarking: Release benchmarks for Node <code>9.1</code>; UTxO-HD in-memory benchmarks; <code>typed-protocols</code> feature benchmarks.</li><li>Development: Correct resource trace emission for CPU 85% spans metric. Governance action benchmarking still under development.</li><li>Workbench: Preparations for bumping <code>nixpkgs</code>. Started removal of the container-based <code>podman</code> backend. Support GHC9.8 <code>nix</code> shells.</li><li>Infrastructure: Test and validate an upcoming change in <code>node-to-node</code> submission protocol.</li><li>Tracing: <code>cardano-tracer</code>: Support of non-<code>systemd</code> Linux was merged; safe restart of internal monitoring servers.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="low-level-overview">Low level overview<a class="hash-link" href="#low-level-overview" title="Direct link to heading">â</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking">Benchmarking<a class="hash-link" href="#benchmarking" title="Direct link to heading">â</a></h3><p>We&#x27;ve run and analyzed a full set of release benchmarks for Node version <code>9.1</code>. Comparing with the mainnet release <code>9.0</code>, we could not observe any performance regression.  </p><p>Additionally, we&#x27;ve performed feature benchmarks for an upcoming new API for <code>typed-protocols</code>. Those did not
exhibit any regression either in comparison with the baseline using the current API.  </p><p>Furthermore, we&#x27;ve performed various benchmarks for the UTxO-HD in-memory backend on Node versions <code>9.0</code> and <code>9.1</code>. Based
on those observations, a rare race condition could be eliminated, where block producers on occasion failed to fork off a thread for the forging loop. The overall network performance of the UTxO-HD in memory backend shows a slight improvement over the regular node, but currently comes with a slightly increased RAM usage.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="development">Development<a class="hash-link" href="#development" title="Direct link to heading">â</a></h3><p>We&#x27;ve spotted an inconsistency in one of our benchmarking metrics - CPU 85% spans - which measures the average number
of consecutive slots where CPU usage spikes to 85% or higher (however short the spike itself might be). There was a difference between legacy tracing system (which yielded the correct value) and the new one, for which a fix has already been devised.  </p><p>The implementation of Conway governance action workloads for benchmarking is ongoing.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="workbench">Workbench<a class="hash-link" href="#workbench" title="Direct link to heading">â</a></h3><p>With a <code>nixpkgs</code> bump on the horizon, we&#x27;re working on adjusting, and testing, our usage of packages that change their status, lose their support, or packages that require pinning a version for the workbench.  </p><p>Additionally, we&#x27;ll remove a container-based backend for workbench, which ties in OCI image usage on <code>podman</code> with
Nomad. It was a precursor to the current Nomad backend, which is containerless and can directly build Nomad jobs using <code>nix</code>.  </p><p>Last not least, we&#x27;ve merged a small PR which enables our workbench to build <code>nix</code> shells with GHC9.8, as this not only
pulls in the compiler, but much of the Haskell development toolchain. The correct version couplings between compiler and toolchain components is now declared explicitly from GHC8.10.7 up to GHC9.8.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="infrastructure">Infrastructure<a class="hash-link" href="#infrastructure" title="Direct link to heading">â</a></h3><p>We&#x27;ve tested and validated an upcoming change in <code>ouroboros-network</code> which demands any node-to-node submission client to
hold the connection for at least one minute before being able to submit transactions. The change works
as expected and does not interfere with special functionality required by benchmarking.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tracing">Tracing<a class="hash-link" href="#tracing" title="Direct link to heading">â</a></h3><p>The trace consumer service for the new tracing system used to require <code>systemd</code> on Linux to build and operate. There are, however, Linux environments that choose to not use <code>systemd</code>. It is now possible to configure the desired flavour of that service, <code>cardano-tracer</code>, at build time, thus adding support for those Linuxes - <a href="https://github.com/IntersectMBO/cardano-node/issues/5021" target="_blank" rel="noopener noreferrer">cardano-node#5021</a>.  </p><p><code>cardano-tracer</code> consumes not just traces, but also metrics. With the new tracing system, this shifts running a
metrics server from the node to the consumer process. One possible setup in the new system is operating only one consumer service and connecting multiple nodes to it. In its current design, this requires to safely shutdown and restart the monitoring server, using the metrics store of any connected node that&#x27;s been requested. We&#x27;re currently
battle-testing <code>ekg</code>&#x27;s (the monitoring package that&#x27;s being used) built-in behaviour and exploring solutions in case it does not fully meet requirements.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/performance-tracing">performance-tracing</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2024-07-23-performance-and-tracing">Performance &amp; Tracing Update</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-07-23T00:00:00.000Z" itemprop="datePublished">July 23, 2024</time> Â· <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/mgmeier" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/mgmeier.png" alt="Michael Karg"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/mgmeier" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Michael Karg</span></a></div><small class="avatar__subtitle" itemprop="description">Performance and Tracing Team Lead</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-summary">High level summary<a class="hash-link" href="#high-level-summary" title="Direct link to heading">â</a></h2><ul><li>Benchmarking: Release benchmarks for Node <code>9.0</code>; Plutus execution budget scaling benchmarks.</li><li>Development: Improved shutdown behaviour for <code>tx-generator</code> merged to <code>master</code>. Work on governance action benchmarking workload is ongoing.</li><li>Workbench: Haskell profile content definition merged to <code>master</code>.</li><li>Tracing: Factoring out RTView was merged to <code>master</code>. Work on metrics naming ongoing, minimizing migration effort.</li><li>Consensus QTAs: Design for automating and data warehousing <code>beacon</code> measurements is complete.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="low-level-overview">Low level overview<a class="hash-link" href="#low-level-overview" title="Direct link to heading">â</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking">Benchmarking<a class="hash-link" href="#benchmarking" title="Direct link to heading">â</a></h3><p>Runs and analyses for a full set of release benchmarks have been performed - and published - for Node version <code>9.0.0</code>. Comparing with the latest mainnet release <code>8.12.1</code>, we could not observe any performance regression. <code>9.0.0</code> exhibits
an improvement in Block Fetch duration, which results in slightly better overall network performance.  </p><p>Additionally, we&#x27;ve performed scaling benchmarks of Plutus execution budgets. In these series of benchmarks, we measure the performance impact of changes to those budgets in the protocol parameters. Steps (CPU) and memory budgets
are scaled independently of each other, and performance testing takes place using Plutus scripts that either are heavy on allocations but light on CPU, or vice versa. These performance tests are meant to explore the headroom of those budgets, taking
into account cost model changes, and recent optimization capabilites of the Plutus compiler.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="development">Development<a class="hash-link" href="#development" title="Direct link to heading">â</a></h3><p>Our workload submission service <code>tx-generator</code> has been equipped with the ability to handle POSIX signals for graceful shutdown scenarios. Furthermore, as it is highly concurrent, error reporting on a per-thread basis has been added, enhancing feedback from the service.
Along with some quality-of-life improvements, these changes have landed in <code>master</code>.  </p><p>The Conway governance action workloads for benchmarking have completed design phase, and we&#x27;ve settled on an implementation plan. Implementation work itself has started.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="workbench">Workbench<a class="hash-link" href="#workbench" title="Direct link to heading">â</a></h3><p>Generating the contents for any benchmarking profile has now become a dedicated Haskell tool, <code>cardano-profile</code>, which has landed in <code>master</code>. Adding type safety and a test suite to profile definitions is a major improvement over
shell code that directly manipulates JSON objects. Furthermore, it makes reliably modifying, or creating, benchmarking profiles much more accessible to engineers outside of our team.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tracing">Tracing<a class="hash-link" href="#tracing" title="Direct link to heading">â</a></h3><p>With factoring out RTView, and making it an opt-in component of the <code>cardano-tracer</code> build, we&#x27;ve reduced the service&#x27;s dependency graph significantly. Furthermore, the service has become more lightweight on resources. We&#x27;ll continue to maintain
RTView, and guarantee it will remain buildable and usable in the future.  </p><p>Aligning metrics naming and semantics of new and legacy tracing is ongoing work. This task is part of a larger endeavour to minimize the effort necessary for users to migrate to the new system.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="consensus-qtas">Consensus QTAs<a class="hash-link" href="#consensus-qtas" title="Direct link to heading">â</a></h3><p><code>beacon</code>, which currently measures performance of certain ledger operations on actual workload fragments, is a first step in building a benchmarking framework based on Delta-Q system design and quantitative timeliness agreements. We&#x27;ve finished the
design of how to automate those measurements at sensible points in time, and provide a storage schema which will enable access and analysis that fits with the framwork.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/performance-tracing">performance-tracing</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/tags/performance-tracing/page/3"><div class="pagination-nav__label">Newer Entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tags/performance-tracing/page/5"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/tags">Tags</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 Intersect, Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a4621276.js"></script>
<script src="/assets/js/main.40817c1a.js"></script>
</body>
</html>